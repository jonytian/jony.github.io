<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 3 › 子非鱼</title>
  <meta name="author" content="jony">
  
  <meta name="description" content="Test description">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="子非鱼"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="子非鱼" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 5.1.1"></head>


<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/">子非鱼</a></h1>
  <h2><a href="/"></a></h2>
  <nav id="main-nav">
    <ul>
      
      <li><a href="/about">About</a></li>
      
      <li><a href="/archives">Archives</a></li>
      
      <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/Java并发/多线程中 interrupt、interrupted 、isInterrupted 区别/">Java多线程</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <p> 1、interrupt<br>interrupt方法用于中断线程。调用该方法的线程的状态为将被置为”中断”状态。<br>注意：线程中断仅仅是置线程的中断状态位，不会停止线程。需要用户自己去监视线程的状态为并做处理。支持线程中断的方法（也就是线程中断后会抛出interruptedException的方法）就是在监视线程的中断状态，一旦线程的中断状态被置为“中断状态”，就会抛出中断异常。</p>
<p>2、interrupted 和 isInterrupted<br>首先看一下该方法的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static boolean interrupted () &#123;</span><br><span class="line"></span><br><span class="line">     return currentThread().isInterrupted(true);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该方法就是直接调用当前线程的isInterrupted(true)方法。<br>然后再来看一下 isInterrupted的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public boolean isInterrupted () &#123;</span><br><span class="line"></span><br><span class="line">     return isInterrupted( false);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这两个方法有两个主要区别：</p>
<pre><code>interrupted 是作用于当前线程，isInterrupted 是作用于调用该方法的线程对象所对应的线程。（线程对象对应的线程不一定是当前运行的线程。例如我们可以在A线程中去调用B线程对象的isInterrupted方法。）
这两个方法最终都会调用同一个方法，只不过参数一个是true，一个是false；</code></pre>
<p>第二个区别主要体现在调用的方法的参数上，让我们来看一看这个参数是什么含义</p>
<p>先来看一看被调用的方法 isInterrupted(boolean arg)的定义：<br>1<br>    private native boolean isInterrupted( boolean ClearInterrupted);<br>原来这是一个本地方法，看不到源码。不过没关系，通过参数名我们就能知道，这个参数代表是否要清除状态位。</p>
<p>如果这个参数为true，说明返回线程的状态位后，要清掉原来的状态位（恢复成原来情况）。这个参数为false，就是直接返回线程的状态位。</p>
<p>这两个方法很好区分，只有当前线程才能清除自己的中断位（对应interrupted（）方法）</p>
<p>是不是这样理解呢，<br>Thread.currentThread().interrupt(); 这个用于清除中断状态，这样下次调用Thread.interrupted()方法时就会一直返回为false，因为中断标志已经被恢复了。<br>而调用isInterrupted 只是简单的查询中断状态，不会对状态进行修改。<br>interrupt（）是用来设置中断状态的。返回true说明中断状态被设置了而不是被清除了。我们调用sleep、wait等此类可中断（throw InterruptedException）方法时，一旦方法抛出InterruptedException，当前调用该方法的线程的中断状态就会被jvm自动清除了，就是说我们调用该线程的isInterrupted 方法时是返回false。如果你想保持中断状态，可以再次调用interrupt方法设置中断状态。这样做的原因是，java的中断并不是真正的中断线程，而只设置标志位（中断位）来通知用户。如果你捕获到中断异常，说明当前线程已经被中断，不需要继续保持中断位。<br>interrupted是静态方法，返回的是当前线程的中断状态。例如，如果当前线程被中断（没有抛出中断异常，否则中断状态就会被清除），你调用interrupted方法，第一次会返回true。然后，当前线程的中断状态被方法内部清除了。第二次调用时就会返回false。如果你刚开始一直调用isInterrupted，则会一直返回true，除非中间线程的中断状态被其他操作清除了。</p>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/Java并发/如何在 Java 中正确使用 wait, notify 和 notifyAll – 以生产者消费者模型为例/">如何在 Java 中正确使用 wait, notify 和 notifyAll – 以生产者消费者模型为例</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <p>wait, notify 和 notifyAll，这些在多线程中被经常用到的保留关键字，在实际开发的时候很多时候却并没有被大家重视。本文对这些关键字的使用进行了描述。</p>
<p>在 Java 中可以用 wait、notify 和 notifyAll 来实现线程间的通信。。举个例子，如果你的Java程序中有两个线程——即生产者和消费者，那么生产者可以通知消费者，让消费者开始消耗数据，因为队列缓冲区中有内容待消费（不为空）。相应的，消费者可以通知生产者可以开始生成更多的数据，因为当它消耗掉某些数据后缓冲区不再为满。</p>
<p>我们可以利用wait()来让一个线程在某些条件下暂停运行。例如，在生产者消费者模型中，生产者线程在缓冲区为满的时候，消费者在缓冲区为空的时候，都应该暂停运行。如果某些线程在等待某些条件触发，那当那些条件为真时，你可以用 notify 和 notifyAll 来通知那些等待中的线程重新开始运行。不同之处在于，notify 仅仅通知一个线程，并且我们不知道哪个线程会收到通知，然而 notifyAll 会通知所有等待中的线程。换言之，如果只有一个线程在等待一个信号灯，notify和notifyAll都会通知到这个线程。但如果多个线程在等待这个信号灯，那么notify只会通知到其中一个，而其它线程并不会收到任何通知，而notifyAll会唤醒所有等待中的线程。</p>
<p>在这篇文章中你将会学到如何使用 wait、notify 和 notifyAll 来实现线程间的通信，从而解决生产者消费者问题。如果你想要更深入地学习Java中的多线程同步问题，我强烈推荐阅读Brian Goetz所著的《Java Concurrency in Practice | Java 并发实践》，不读这本书你的 Java 多线程征程就不完整哦！这是我最向Java开发者推荐的书之一。<br>如何使用Wait</p>
<p>尽管关于wait和notify的概念很基础，它们也都是Object类的函数，但用它们来写代码却并不简单。如果你在面试中让应聘者来手写代码，用wait和notify解决生产者消费者问题，我几乎可以肯定他们中的大多数都会无所适从或者犯下一些错误，例如在错误的地方使用 synchronized 关键词，没有对正确的对象使用wait，或者没有遵循规范的代码方法。说实话，这个问题对于不常使用它们的程序员来说确实令人感觉比较头疼。</p>
<p>第一个问题就是，我们怎么在代码里使用wait()呢？因为wait()并不是Thread类下的函数，我们并不能使用Thread.call()。事实上很多Java程序员都喜欢这么写，因为它们习惯了使用Thread.sleep()，所以他们会试图使用wait() 来达成相同的目的，但很快他们就会发现这并不能顺利解决问题。正确的方法是对在多线程间共享的那个Object来使用wait。在生产者消费者问题中，这个共享的Object就是那个缓冲区队列。</p>
<p>第二个问题是，既然我们应该在synchronized的函数或是对象里调用wait，那哪个对象应该被synchronized呢？答案是，那个你希望上锁的对象就应该被synchronized，即那个在多个线程间被共享的对象。在生产者消费者问题中，应该被synchronized的就是那个缓冲区队列。（我觉得这里是英文原文有问题……本来那个句末就不应该是问号不然不太通……）</p>
<p><img src="http://jbcdn2.b0.upaiyun.com/2015/07/5fda7f863416140cb97a8c8977dfd5db.png" alt="这里写图片描述"></p>
<p>永远在循环（loop）里调用 wait 和 notify，不是在 If 语句</p>
<p>现在你知道wait应该永远在被synchronized的背景下和那个被多线程共享的对象上调用，下一个一定要记住的问题就是，你应该永远在while循环，而不是if语句中调用wait。因为线程是在某些条件下等待的——在我们的例子里，即“如果缓冲区队列是满的话，那么生产者线程应该等待”，你可能直觉就会写一个if语句。但if语句存在一些微妙的小问题，导致即使条件没被满足，你的线程你也有可能被错误地唤醒。所以如果你不在线程被唤醒后再次使用while循环检查唤醒条件是否被满足，你的程序就有可能会出错——例如在缓冲区为满的时候生产者继续生成数据，或者缓冲区为空的时候消费者开始小号数据。所以记住，永远在while循环而不是if语句中使用wait！我会推荐阅读《Effective Java》，这是关于如何正确使用wait和notify的最好的参考资料。</p>
<p>基于以上认知，下面这个是使用wait和notify函数的规范代码模板：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; The standard idiom for calling the wait method in Java </span><br><span class="line">synchronized (sharedObject) &#123; </span><br><span class="line">    while (condition) &#123; </span><br><span class="line">    sharedObject.wait(); </span><br><span class="line">        &#x2F;&#x2F; (Releases lock, and reacquires on wakeup) </span><br><span class="line">    &#125; </span><br><span class="line">    &#x2F;&#x2F; do action based upon condition e.g. take or put into queue </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就像我之前说的一样，在while循环里使用wait的目的，是在线程被唤醒的前后都持续检查条件是否被满足。如果条件并未改变，wait被调用之前notify的唤醒通知就来了，那么这个线程并不能保证被唤醒，有可能会导致死锁问题。<br>Java wait(), notify(), notifyAll() 范例</p>
<p>下面我们提供一个使用wait和notify的范例程序。在这个程序里，我们使用了上文所述的一些代码规范。我们有两个线程，分别名为PRODUCER（生产者）和CONSUMER（消费者），他们分别继承了了Producer和Consumer类，而Producer和Consumer都继承了Thread类。Producer和Consumer想要实现的代码逻辑都在run()函数内。Main线程开始了生产者和消费者线程，并声明了一个LinkedList作为缓冲区队列（在Java中，LinkedList实现了队列的接口）。生产者在无限循环中持续往LinkedList里插入随机整数直到LinkedList满。我们在while(queue.size == maxSize)循环语句中检查这个条件。请注意到我们在做这个检查条件之前已经在队列对象上使用了synchronized关键词，因而其它线程不能在我们检查条件时改变这个队列。如果队列满了，那么PRODUCER线程会在CONSUMER线程消耗掉队列里的任意一个整数，并用notify来通知PRODUCER线程之前持续等待。在我们的例子中，wait和notify都是使用在同一个共享对象上的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">import java.util.LinkedList; </span><br><span class="line">import java.util.Queue; </span><br><span class="line">import java.util.Random; </span><br><span class="line">&#x2F;** </span><br><span class="line">* Simple Java program to demonstrate How to use wait, notify and notifyAll() </span><br><span class="line">* method in Java by solving producer consumer problem.</span><br><span class="line">* </span><br><span class="line">* @author Javin Paul </span><br><span class="line">*&#x2F;</span><br><span class="line">public class ProducerConsumerInJava &#123; </span><br><span class="line">    public static void main(String args[]) &#123; </span><br><span class="line">        System.out.println(&quot;How to use wait and notify method in Java&quot;); </span><br><span class="line">        System.out.println(&quot;Solving Producer Consumper Problem&quot;); </span><br><span class="line">        Queue&lt;Integer&gt; buffer &#x3D; new LinkedList&lt;&gt;(); </span><br><span class="line">        int maxSize &#x3D; 10; </span><br><span class="line">        Thread producer &#x3D; new Producer(buffer, maxSize, &quot;PRODUCER&quot;); </span><br><span class="line">        Thread consumer &#x3D; new Consumer(buffer, maxSize, &quot;CONSUMER&quot;); </span><br><span class="line">        producer.start(); consumer.start(); &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    &#x2F;** </span><br><span class="line">    * Producer Thread will keep producing values for Consumer </span><br><span class="line">    * to consumer. It will use wait() method when Queue is full </span><br><span class="line">    * and use notify() method to send notification to Consumer </span><br><span class="line">    * Thread. </span><br><span class="line">    * </span><br><span class="line">    * @author WINDOWS 8 </span><br><span class="line">    * </span><br><span class="line">    *&#x2F;</span><br><span class="line">    class Producer extends Thread </span><br><span class="line">    &#123; private Queue&lt;Integer&gt; queue; </span><br><span class="line">        private int maxSize; </span><br><span class="line">        public Producer(Queue&lt;Integer&gt; queue, int maxSize, String name)&#123; </span><br><span class="line">            super(name); this.queue &#x3D; queue; this.maxSize &#x3D; maxSize; </span><br><span class="line">        &#125; </span><br><span class="line">        @Override public void run() </span><br><span class="line">        &#123; </span><br><span class="line">            while (true) </span><br><span class="line">                &#123; </span><br><span class="line">                    synchronized (queue) &#123; </span><br><span class="line">                        while (queue.size() &#x3D;&#x3D; maxSize) &#123; </span><br><span class="line">                            try &#123; </span><br><span class="line">                                System.out .println(&quot;Queue is full, &quot; + &quot;Producer thread waiting for &quot; + &quot;consumer to take something from queue&quot;); </span><br><span class="line">                                queue.wait(); </span><br><span class="line">                            &#125; catch (Exception ex) &#123; </span><br><span class="line">                                ex.printStackTrace(); &#125; </span><br><span class="line">                            &#125; </span><br><span class="line">                            Random random &#x3D; new Random(); </span><br><span class="line">                            int i &#x3D; random.nextInt(); </span><br><span class="line">                            System.out.println(&quot;Producing value : &quot; + i); queue.add(i); queue.notifyAll(); </span><br><span class="line">                        &#125; </span><br><span class="line">                    &#125; </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">    &#x2F;** </span><br><span class="line">    * Consumer Thread will consumer values form shared queue. </span><br><span class="line">    * It will also use wait() method to wait if queue is </span><br><span class="line">    * empty. It will also use notify method to send </span><br><span class="line">    * notification to producer thread after consuming values </span><br><span class="line">    * from queue. </span><br><span class="line">    * </span><br><span class="line">    * @author WINDOWS 8 </span><br><span class="line">    * </span><br><span class="line">    *&#x2F;</span><br><span class="line">    class Consumer extends Thread &#123; </span><br><span class="line">        private Queue&lt;Integer&gt; queue; </span><br><span class="line">        private int maxSize; </span><br><span class="line">        public Consumer(Queue&lt;Integer&gt; queue, int maxSize, String name)&#123; </span><br><span class="line">            super(name); </span><br><span class="line">            this.queue &#x3D; queue; </span><br><span class="line">            this.maxSize &#x3D; maxSize; </span><br><span class="line">        &#125; </span><br><span class="line">        @Override public void run() &#123; </span><br><span class="line">            while (true) &#123; </span><br><span class="line">                synchronized (queue) &#123; </span><br><span class="line">                    while (queue.isEmpty()) &#123; </span><br><span class="line">                        System.out.println(&quot;Queue is empty,&quot; + &quot;Consumer thread is waiting&quot; + &quot; for producer thread to put something in queue&quot;); </span><br><span class="line">                        try &#123; </span><br><span class="line">                            queue.wait(); </span><br><span class="line">                        &#125; catch (Exception ex) &#123; </span><br><span class="line">                            ex.printStackTrace(); </span><br><span class="line">                        &#125; </span><br><span class="line">                    &#125; </span><br><span class="line">                    System.out.println(&quot;Consuming value : &quot; + queue.remove()); queue.notifyAll(); </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://jbcdn2.b0.upaiyun.com/2015/07/19b8448d72b097bda0616b703b0d7db3.png" alt="这里写图片描述"></p>
<p>为了更好地理解这个程序，我建议你在debug模式里跑这个程序。一旦你在debug模式下启动程序，它会停止在PRODUCER或者CONSUMER线程上，取决于哪个线程占据了CPU。因为两个线程都有wait()的条件，它们一定会停止，然后你就可以跑这个程序然后看发生什么了（很有可能它就会输出我们以上展示的内容）。你也可以使用Eclipse里的Step into和Step over按钮来更好地理解多线程间发生的事情。<br>本文重点：</p>
<ol>
<li><p>你可以使用wait和notify函数来实现线程间通信。你可以用它们来实现多线程（&gt;3）之间的通信。</p>
</li>
<li><p>永远在synchronized的函数或对象里使用wait、notify和notifyAll，不然Java虚拟机会生成 IllegalMonitorStateException。</p>
</li>
<li><p>永远在while循环里而不是if语句下使用wait。这样，循环会在线程睡眠前后都检查wait的条件，并在条件实际上并未改变的情况下处理唤醒通知。</p>
</li>
<li><p>永远在多线程间共享的对象（在生产者消费者模型里即缓冲区队列）上使用wait。</p>
</li>
<li><p>基于前文提及的理由，更倾向用 notifyAll()，而不是 notify()。</p>
</li>
</ol>
<p><img src="http://jbcdn2.b0.upaiyun.com/2015/07/fb4daecd5650cb2c82b9eb7cd9d54e3f.png" alt="这里写图片描述"></p>
<p>这是关于Java里如何使用wait, notify和notifyAll的所有重点啦。你应该只在你知道自己要做什么的情况下使用这些函数，不然Java里还有很多其它的用来解决同步问题的方案。例如，如果你想使用生产者消费者模型的话，你也可以使用BlockingQueue，它会帮你处理所有的线程安全问题和流程控制。如果你想要某一个线程等待另一个线程做出反馈再继续运行，你也可以使用CycliBarrier或者CountDownLatch。如果你只是想保护某一个资源的话，你也可以使用Semaphore。</p>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/Linux/Linux进程线程查看命令与java线程的监控分析/">Linux进程线程查看命令与java线程的监控分析</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <h2 id="Linux进程查看命令"><a href="#Linux进程查看命令" class="headerlink" title="Linux进程查看命令"></a>Linux进程查看命令</h2><h3 id="PS命令"><a href="#PS命令" class="headerlink" title="PS命令"></a>PS命令</h3><ul>
<li><p>1.不带参数的ps使用</p>
<p>  <img src="https://img-blog.csdn.net/20180326193105204?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>2.显示所有的当前进程</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps –ax  -a 代表 all。同时加上x参数会显示没有控制终端的进程。</span><br><span class="line">ps -ax | less 可以结合less命令和管道来使用以方便查看。</span><br></pre></td></tr></table></figure></li>
<li><p>3.通过cpu和内存使用来过滤进程</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | less</span><br><span class="line">默认的结果集是未排好序的。可以通过 –sort命令来排序。</span><br><span class="line">根据 CPU 使用来升序排序</span><br><span class="line">ps -aux --sort -pcpu | less</span><br><span class="line">根据 内存使用 来升序排序</span><br><span class="line">ps -aux --sort -pmem | less</span><br><span class="line">我们也可以将它们合并到一个命令，并通过管道显示前10个结果：</span><br><span class="line">ps -aux --sort -pcpu,+pmem | head -n 10</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>4.通过进程名和PID过滤</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -f -C [进程名]</span><br><span class="line">ps -f -C mysqld</span><br></pre></td></tr></table></figure>

<p>  <img src="https://img-blog.csdn.net/20180326193641782?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>5.树形显示进程</p>
<p>  <img src="https://img-blog.csdn.net/20180326193834102?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>6.查看所有关于java的进程</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep java</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="top命令"><a href="#top命令" class="headerlink" title="top命令"></a>top命令</h3><ul>
<li>1.top命令经常用来监控Linux的系统状况，比如cpu、内存的使用。</li>
</ul>
<p><img src="https://img-blog.csdn.net/20180326194526863?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<ul>
<li><p>2.第一行：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一块：当前系统时间</span><br><span class="line">第二块：系统已经运行了3天23小时26分</span><br><span class="line">第三块：当前有1个用户登录系统</span><br><span class="line">第四块：load average后面的三个数分别是1分钟、5分钟、15分钟的负载情况。load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算		出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.第二行：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第一块：系统现在有431个进程</span><br><span class="line">第二块：有一个进程处于运行状态</span><br><span class="line">第三块：428个进程处于休眠状态</span><br><span class="line">第四块：0个进程处于stopped状态</span><br><span class="line">第五块：2个进程处于zombie状态</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.第三行：cpu状态</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0.4 us — 用户空间占用CPU的百分比。</span><br><span class="line">0.5 sy — 内核空间占用CPU的百分比。</span><br><span class="line">0.0 ni — 改变过优先级的进程占用CPU的百分比</span><br><span class="line">99.0 id — 空闲CPU百分比</span><br><span class="line">0.0 wa — IO等待占用CPU的百分比</span><br><span class="line">0.0 hi — 硬中断（Hardware IRQ）占用CPU的百分比</span><br><span class="line">0.0 si — 软中断（Software Interrupts）占用CPU的百分比</span><br><span class="line">用户空间就是用户进程所在的内存区域，相对的，系统空间就是操作系统占据的内存区域。用户进程和系统进程的所有数据都在内存中。</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>5.第四行：内存状态（单位k）</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">16237008 total — 物理内存总量（16.2GB）</span><br><span class="line">10904524 used — 使用中的内存总量（10.9GB）</span><br><span class="line">1984320  free — 空闲内存总量（2.0G）</span><br><span class="line">3348164  buffers — 缓存的内存量 （3.3G）</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>6.第五行：swap交换分区</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5119996 total — 交换区总量（5GB）</span><br><span class="line">0       used — 使用的交换区总量（0）</span><br><span class="line">5119996 free — 空闲交换区总量（5GB）</span><br><span class="line">4800960 cached — 缓冲的交换区总量（4.8GB）</span><br></pre></td></tr></table></figure>

<p>  可用内存数的近似的计算公式：第四行的free + 第四行的buffers + 第五行的cached。<br>我们最关心的内存监控是第五行swap（类似于虚拟内存）交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是可以判定服务器的内存不够用了。</p>
</li>
<li><p>7.第六行：各进程（任务）的状态监控</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PID — 进程id</span><br><span class="line">USER — 进程所有者</span><br><span class="line">PR — 进程优先级</span><br><span class="line">NI — nice值。负值表示高优先级，正值表示低优先级</span><br><span class="line">VIRT — 进程使用的虚拟内存总量，单位kb。VIRT&#x3D;SWAP+RES</span><br><span class="line">RES — 进程使用的、未被换出的物理内存大小，单位kb。RES&#x3D;CODE+DATA</span><br><span class="line">SHR — 共享内存大小，单位kb</span><br><span class="line">S — 进程状态。D&#x3D;不可中断的睡眠状态 R&#x3D;运行 S&#x3D;睡眠 T&#x3D;跟踪&#x2F;停止 Z&#x3D;僵尸进程</span><br><span class="line">%CPU — 上次更新到现在的CPU时间占用百分比</span><br><span class="line">%MEM — 进程使用的物理内存百分比</span><br><span class="line">TIME+ — 进程使用的CPU时间总计，单位1&#x2F;100秒</span><br><span class="line">COMMAND — 进程名称（命令名&#x2F;命令行）</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="线程查看命令"><a href="#线程查看命令" class="headerlink" title="线程查看命令"></a>线程查看命令</h2><h3 id="top-–H（列出所有的线程）"><a href="#top-–H（列出所有的线程）" class="headerlink" title="top –H（列出所有的线程）"></a>top –H（列出所有的线程）</h3><p><img src="https://img-blog.csdn.net/20180326195231168?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h3 id="让top输出某个特定进程-pid-并检查该进程内运行的线程状况"><a href="#让top输出某个特定进程-pid-并检查该进程内运行的线程状况" class="headerlink" title="让top输出某个特定进程[pid]并检查该进程内运行的线程状况"></a>让top输出某个特定进程[pid]并检查该进程内运行的线程状况</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">让top输出某个特定进程[pid]并检查该进程内运行的线程状况：</span><br><span class="line">top -H -p [pid]</span><br><span class="line"></span><br></pre></td></tr></table></figure></code></pre>
<p><img src="https://img-blog.csdn.net/20180326195321929?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h3 id="查看由进程号为-pid-的进程创建的所有线程"><a href="#查看由进程号为-pid-的进程创建的所有线程" class="headerlink" title="查看由进程号为[pid]的进程创建的所有线程"></a>查看由进程号为[pid]的进程创建的所有线程</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -T -p [pid]</span><br></pre></td></tr></table></figure></code></pre>
<p><img src="https://img-blog.csdn.net/20180326194406332?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h2 id="Java线程监控分析（一般流程）"><a href="#Java线程监控分析（一般流程）" class="headerlink" title="Java线程监控分析（一般流程）"></a>Java线程监控分析（一般流程）</h2><h3 id="1-先用top命令找出占用资源比较多的java进程id"><a href="#1-先用top命令找出占用资源比较多的java进程id" class="headerlink" title="1.先用top命令找出占用资源比较多的java进程id"></a>1.先用top命令找出占用资源比较多的java进程id</h3><p><img src="https://img-blog.csdn.net/20180326212712948?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>我们以第一个进程为例，对该进程的所有线程进行监控</p>
<h3 id="2-查看相关进程的所有线程"><a href="#2-查看相关进程的所有线程" class="headerlink" title="2.查看相关进程的所有线程"></a>2.查看相关进程的所有线程</h3><p><img src="https://img-blog.csdn.net/20180326213435746?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>接下来我们以第一个线程为例，对其进行监控分析</p>
<h3 id="3-然后借助JVM的-jconsole-exe-工具对相应线程进行具体分析"><a href="#3-然后借助JVM的-jconsole-exe-工具对相应线程进行具体分析" class="headerlink" title="3.然后借助JVM的 jconsole.exe  工具对相应线程进行具体分析"></a>3.然后借助JVM的 jconsole.exe  工具对相应线程进行具体分析</h3><p><img src="https://img-blog.csdn.net/20180326214337895?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>jconsole具体使用细节可以参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/ithomer/article/details/9923311">https://blog.csdn.net/ithomer/article/details/9923311</a> ，这里就不做过多的介绍了。</p>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/Maven/Maven基本使用（图文教程）/">Maven基本使用</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <h1 id="Maven基本使用"><a href="#Maven基本使用" class="headerlink" title="Maven基本使用"></a>Maven基本使用</h1><h2 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h2><ul>
<li><p>先去官网下载maven（<a target="_blank" rel="noopener" href="http://maven.apache.org/download.cgi%EF%BC%89">http://maven.apache.org/download.cgi）</a></p>
</li>
<li><p>下载下来解压后如下所示<br><img src="http://img.blog.csdn.net/20180223133352895?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>配置环境变量<br><img src="http://img.blog.csdn.net/20180223133732674?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180223133741955?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>查看配置成功与否<br><img src="http://img.blog.csdn.net/20180223134057395?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>maven配置文件<br><img src="http://img.blog.csdn.net/20180223134253567?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>maven项目目录结构<br><img src="http://img.blog.csdn.net/2018022313551548?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>使用myeclipse构建maven项目<br><img src="http://img.blog.csdn.net/20180223140134174?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
</li>
<li><p>pom.xml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot; </span><br><span class="line">	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.robinliew.foo&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;foo-war&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- </span><br><span class="line">	maven 的所有构件均通过坐标进行组织和管理。maven 的坐标通过 5 个元素进行定义，其中 groupId、artifactId、version 是必须的，packaging 是可选的（默认为jar），classifier 是不能直接定义的。</span><br><span class="line">	</span><br><span class="line">	groupId组名，主项目标识  定义当前 Maven 项目所属的实际项目，跟 Java 包名类似</span><br><span class="line">	artifactId - 工程名，子项目（模块）标识  定义当前 Maven 项目的一个模块，默认情况下，Maven 生成的构件，其文件名会以 artifactId 开头</span><br><span class="line">	packaging - 打包方式  定义项目打包方式，如 jar，war，pom，zip ……，默认为 jar。</span><br><span class="line">	version - 版本</span><br><span class="line">	name - 项目描述名</span><br><span class="line">	classifier：定义项目的附属构件。classifier 不能直接定义，通常由附加的插件帮助生成</span><br><span class="line"> --&gt;</span><br><span class="line">  &lt;groupId&gt;com.robinliew.mavendemo&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;version&gt;0.0.1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;artifactId&gt;com.robinliew.mavendemo&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;war&lt;&#x2F;packaging&gt;</span><br><span class="line">  &lt;name&gt;mavendemo&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;description&gt;maven快速入门&lt;&#x2F;description&gt;</span><br><span class="line">  &lt;!-- 配置依赖的jar包 -&gt;</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">	        &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">	        &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">	&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br><span class="line">  </span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>依赖详解<br><img src="http://img.blog.csdn.net/20180224140752751?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<ul>
<li>其中依赖范围有如下几种<ul>
<li>compile：编译依赖范围，默认值。此选项对编译、测试、运行三种 classpath 都有效，如 hibernate-core-3.6.5.Final.jar，表明在编译、测试、运行的时候都需要该依赖</li>
<li>test：测试依赖范围。只对测试有效，表明只在测试的时候需要，在编译和运行时将无法使用该类依赖，如 junit；</li>
<li>provided：已提供依赖范围。编译和测试有效，运行无效。如 servlet-api ，在项目运行时，tomcat 等容器已经提供，无需 Maven 重复引入；</li>
<li>runtime：运行时依赖范围。测试和运行有效，编译无效。如 jdbc 驱动实现，编译时只需接口，测试或运行时才需要具体的 jdbc 驱动实现；</li>
<li>system：系统依赖范围。和 provided 依赖范围一致，需要通过 <systemPath> 显示指定，且可以引用环境变量；</li>
<li>import：导入依赖范围。使用该选项，通常需要 <type>pom</type>，将目标 pom 的 dependencyManagement 配置导入合并到当前 pom 的  dependencyManagement 元素。</li>
</ul>
</li>
<li>依赖传递和以来范围</li>
<li>依赖冲突</li>
<li>依赖排除</li>
</ul>
</li>
</ul>
<ul>
<li>创建一个maven工程<br><img src="http://img.blog.csdn.net/20180224085801756?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>默认配置，点击两次next后<br><img src="http://img.blog.csdn.net/20180224085827841?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>如果没有显示上面的archetype骨架列表，则需要我们先进行配置，点击configure如下<br><img src="http://img.blog.csdn.net/20180224090020611?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>远程配置是通过访问<a target="_blank" rel="noopener" href="http://repo1.maven.org/maven2/archetype-catalog.xml%E5%9C%B0%E5%9D%80%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%E7%9A%84%EF%BC%8C%E7%94%B1%E4%BA%8E%E8%AF%A5%E6%96%87%E4%BB%B6%E8%BE%83%E5%A4%A7%EF%BC%8C%E4%B8%94%E8%AE%BF%E9%97%AE%E5%A4%96%E5%9B%BD%E7%BD%91%E5%9D%80%E9%80%9F%E5%BA%A6%E5%BE%88%E6%85%A2%EF%BC%8C%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E7%AD%89%E5%A5%BD%E4%B8%80%E4%BC%9A%EF%BC%8C%E4%B8%8B%E9%9D%A2%E4%BB%8B%E7%BB%8D%E5%8F%A6%E4%B8%80%E7%A7%8D%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">http://repo1.maven.org/maven2/archetype-catalog.xml地址进行配置的，由于该文件较大，且访问外国网址速度很慢，可能需要等好一会，下面介绍另一种本地配置方式</a><br><img src="http://img.blog.csdn.net/20180224090354437?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>这种方式需要提前下载配置文件通。过浏览器查看<a target="_blank" rel="noopener" href="http://repo1.maven.org/maven2/archetype-catalog.xml%E9%A1%B5%E6%BA%90%E7%A0%81%EF%BC%88%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%9B%A0%E4%B8%BA%E6%96%87%E4%BB%B6%E8%BE%83%E5%A4%A7%EF%BC%8C%E7%BD%91%E9%80%9F%E8%BE%83%E6%85%A2%EF%BC%8C%E8%AF%B7%E5%A4%9A%E7%AD%89%E4%B8%80%E4%BC%9A%EF%BC%89%EF%BC%8C%E5%A4%8D%E5%88%B6%E5%88%B0%E6%9C%AC%E5%9C%B0%EF%BC%8C%E5%91%BD%E5%90%8D%E4%B8%BAarchetype-catalog.xml%E3%80%82">http://repo1.maven.org/maven2/archetype-catalog.xml页源码（注意：因为文件较大，网速较慢，请多等一会），复制到本地，命名为archetype-catalog.xml。</a><br>如果你的myeclipse出现卡顿现象，查看是否报GC overhead limit exceeded的错误，如果是可以通过下面的方式解决<br><img src="http://img.blog.csdn.net/20180224090938377?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180224090948196?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>创建好的maven工程如下所示<br><img src="http://img.blog.csdn.net/20180224091213741?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>可以看到默认创建的目录结构只有src/main/resources，缺少 src/main/java和src/test/java 。点击该项目后，右击，选择build path–&gt;configure build path。<br><img src="http://img.blog.csdn.net/20180224092832895?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180224092729186?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180224092851256?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>设置完后我们可以查看maven输出目录<br><img src="http://img.blog.csdn.net/20180224093545328?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>当然这是可以自己点击edit修改的，没有特殊需求的情况下一般不建议修改。<br><img src="http://img.blog.csdn.net/20180224092903810?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>此时maven项目的目录结构完整了。</li>
</ul>
<p>设置 Project Facets,设置部署打包结构,删除测试相关目录<br><img src="http://img.blog.csdn.net/20180224094407254?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180224094459592?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>此时创建一个maven项目完成了。</p>
<ul>
<li>构建及项目部署<br>右键 pom.xml - Run As - Maven -install<br><img src="http://img.blog.csdn.net/20180224131344968?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180224131354536?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></li>
</ul>
<h2 id="二、maven常用的命令"><a href="#二、maven常用的命令" class="headerlink" title="二、maven常用的命令"></a>二、maven常用的命令</h2><ul>
<li>首先通过cmd进入要操作的项目目录<br><img src="http://img.blog.csdn.net/20180224132326163?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><ul>
<li>常用的几种命令<ul>
<li>mvn compile  编译项目源代码</li>
<li>mvn clean  删除 target 目录</li>
<li>mvn test  运行测试（运行src/test/java中的测试代码）</li>
<li>mvn clean package（组合命令）  Maven 自动帮我们完成项目的编译、测试、打包</li>
<li>mvn install  效果跟mvn clean package命令一样，且项目被打包发布到了 maven 的仓库，以后其他项目需要依赖到这个项目，就可以通过在 pom.xml 文件中添加依赖来引用。</li>
<li>mvn archetype:generate  自动创建Maven目录结构<ul>
<li>下面是mvn archetype:generate 的使用例子<br><img src="http://img.blog.csdn.net/20180224135119932?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>默认回车即可，输入groupId等，回车<br><img src="http://img.blog.csdn.net/20180224135131835?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="三、仓库"><a href="#三、仓库" class="headerlink" title="三、仓库"></a>三、仓库</h2><ul>
<li>maven使用一个仓库，通过声明依赖关系可以引用各个构件，各构件通过坐标被maven管理。</li>
<li>maven仓库包括本地仓库和远程仓库。优先从本地仓库（本地仓库默认地址为：${user.home}/.m2/repository。）中寻找相关构件，远程仓库中的构件下载到本地仓库使用。中央仓库是 Maven 核心自带的远程仓库，默认地址：<a target="_blank" rel="noopener" href="http://repo1.maven.org/maven2%E3%80%82%E7%A7%81%E6%9C%8D%E6%98%AF%E6%9E%B6%E8%AE%BE%E5%9C%A8%E6%9C%AC%E6%9C%BA%E6%88%96%E5%B1%80%E5%9F%9F%E7%BD%91%E4%B8%AD%E7%9A%84%E4%B8%80%E7%A7%8D%E7%89%B9%E6%AE%8A%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%EF%BC%8C%E9%80%9A%E8%BF%87%E7%A7%81%E6%9C%8D%E5%8F%AF%E4%BB%A5%E6%96%B9%E4%BE%BF%E7%9A%84%E7%AE%A1%E7%90%86%E5%85%B6%E5%AE%83%E6%89%80%E6%9C%89%E7%9A%84%E5%A4%96%E9%83%A8%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E3%80%82">http://repo1.maven.org/maven2。私服是架设在本机或局域网中的一种特殊的远程仓库，通过私服可以方便的管理其它所有的外部远程仓库。</a></li>
<li>本地仓库的配置<br><img src="http://img.blog.csdn.net/20180224154537235?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180224154546823?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></li>
<li>中央仓库配置（maven默认配置好的）<br><img src="http://img.blog.csdn.net/20180224154952435?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180224155002822?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></li>
<li>镜像仓库的配置<br><img src="http://img.blog.csdn.net/20180224155626947?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></li>
<li>私服的搭建<br>大多数公司使用私服，暂时先写到这，后面抽时间再介绍搭建私服</li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/算法/RS纠删算法原理与项目源码/">RS纠删算法原理</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <p>##RS纠删算法原理</p>
<ul>
<li><p>A.1  纠删码是存储领域常用的数据冗余技术， 相比多副本复制而言， 纠删码能够以更小的数据冗余度获得更高数据可靠性。 Reed Solomon Coding是存储领域常用的一种纠删码，它的基本原理如下：  给定n个数据块d1, d2,…, dn，n和一个正整数m， RS根据n个数据块生成m个校验块， c1, c2,…, cm。  对于任意的n和m，  从n个原始数据块和m 个校验块中任取n块就能解码出原始数据， 即RS最多容忍m个数据块或者校验块同时丢失（纠删码只能容忍数据丢失，无法容忍数据篡改，纠删码正是得名与此）。 </p>
</li>
<li><p>A.2  编码原理<br>RS编码以word为编码和解码单位，  大的数据块拆分到字长为w的word（字长w取值一般为8或者16位），然后对word进行编解码。 所以数据块的编码原理与word编码原理没什么差别， 为论述方便， 后文中变量Di, Ci将代表一个word。<br>首先， 把输入数据视为向量D=(D1，D2，…, Dn）, 编码后数据视为向量（D1, D2,…, Dn, C1, C2,.., Cm)，RS编码可视为如图A.1所示矩阵运算。 下图最左边是编码矩阵， 矩阵上部是单位阵（n行n列），下边是vandermonde矩阵B(m行n列), vandermode矩阵如图A.2所示， 第i行，第j列的原数值为j^(i-1)。之所以采用vandermonde矩阵的原因是， RS数据恢复算法要求编码矩阵任意n*n子矩阵可逆。</p>
<p>  <img src="https://img-blog.csdn.net/20180325135125137?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>  图A.1： 编码运算</p>
<pre><code>![这里写图片描述](https://img-blog.csdn.net/20180325135138980?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)</code></pre>
<p>  图A.2：vandermode矩阵</p>
</li>
<li><p>数据恢复原理<br>RS最多能容忍m个删除错误。 数据恢复原理的过程如下：<br>（1）从编码矩阵中删去丢失数据块和丢失编码块对应行。  假设D1、C2丢失，     根据图A.1所示RS编码运算等式，我们得到如下B’以及等式。  </p>
</li>
</ul>
<p><img src="https://img-blog.csdn.net/20180325135147442?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>（2）由于B‘是可逆的， 两边乘上B’逆矩阵。 </p>
<p><img src="https://img-blog.csdn.net/20180325135155380?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>（3）得到如下原始数据D的计算公式 </p>
<p><img src="https://img-blog.csdn.net/20180325135202691?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWJpbjE5OTFsaXViaW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>（4）对D重新编码，得到丢失的校验码</p>
<p>矩阵求逆采用高斯消元法，   需要进行实数加减乘除四则运算，无法作用于字长为w的二进制数据。 为了解决这个问题， RS采用伽罗华群GF（2^w)中定义的四则运算法则。 GF(2^w）域有2^w个值， 每个值都对应一个低于w次的多项式， 这样域上的四则运算就转换为多项式空间的运算。  GF(2^w)域中的加法就是XOR， 乘法比较特殊，需要维护两个大小为2^w -1的表格: log表gflog，反log表gfilog。<br>乘法公式：  a * b = gfilog(gflog(a) + fglog(b)) % (2^w -1)</p>
<p>##Github项目源码<br>源码来自：<a target="_blank" rel="noopener" href="https://github.com/Backblaze/JavaReedSolomon">https://github.com/Backblaze/JavaReedSolomon</a><br>如果你想处理使用RS纠删算法处理字节数组，可以参照我的GitHub项目（在上一链接的基础上我进行了接口和实现的编写）</p>
<ul>
<li>GitHub链接：  <a target="_blank" rel="noopener" href="https://github.com/RobinLiew/JavaReedSolomon">https://github.com/RobinLiew/JavaReedSolomon</a></li>
<li>使用例子</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.backblaze.erasure.robinliew.dealbytesinterface;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * </span><br><span class="line"> * @author RobinLiew 2017.9.21</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class test &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">	IRSErasureCorrection rsProcessor&#x3D;new RSErasureCorrectionImpl();</span><br><span class="line"></span><br><span class="line">	byte[] data&#x3D;new byte[1000]; </span><br><span class="line">	for(int i&#x3D;0; i&lt;data.length; i++) &#123;  </span><br><span class="line">	    data[i] &#x3D; 1;  </span><br><span class="line">	&#125;  </span><br><span class="line">	for(int i&#x3D;0; i&lt;500; i++) &#123;  </span><br><span class="line">	    data[i] &#x3D; (byte) (16 + i);  </span><br><span class="line">	&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	int sliceCount&#x3D;4;&#x2F;&#x2F;The data is 4 copies(数据为4份)</span><br><span class="line">	int fecSliceCount&#x3D;2;&#x2F;&#x2F;2 copies of erasure redundancy(纠删冗余为2份)</span><br><span class="line">	int sliceLength&#x3D;data.length&#x2F;sliceCount;</span><br><span class="line">	byte[] en_data;</span><br><span class="line">	en_data&#x3D;rsProcessor.rs_Encoder(data, sliceLength, sliceCount, fecSliceCount);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Test use: second pieces of data are lost, and the decoding code has the corresponding test code(测试使用：让第二片数据丢失，解码代码中也有对应的测试代码)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">	byte[] temp &#x3D; new byte[250];</span><br><span class="line">	System.arraycopy(temp, 0, en_data, 250, 250);						</span><br><span class="line">&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">	boolean[] eraserFlag&#x3D;new boolean[sliceCount+fecSliceCount];</span><br><span class="line">	for(int i&#x3D;0;i&lt;eraserFlag.length;i++)&#123;</span><br><span class="line">		eraserFlag[i]&#x3D;true;</span><br><span class="line">	&#125;</span><br><span class="line">	eraserFlag[1]&#x3D;false;</span><br><span class="line"></span><br><span class="line">	int result&#x3D;rsProcessor.rs_Decoder(en_data, sliceLength, sliceCount, fecSliceCount&#x3D;2, eraserFlag);</span><br><span class="line">	System.out.println(&quot;complete test!&quot;);&#x2F;&#x2F;测试完毕！</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/算法/RS（255,223）纠错算法原理与项目源码/">RS（255,223）纠错算法原理</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <h1 id="RS（255-223）纠错算法原理与项目源码"><a href="#RS（255-223）纠错算法原理与项目源码" class="headerlink" title="RS（255,223）纠错算法原理与项目源码"></a>RS（255,223）纠错算法原理与项目源码</h1><p>##1.背景</p>
<ul>
<li><p>数据在网络传输、存储过程中由于信道噪声条件，硬件设备等问题数据产生了差错，这时候应该如何处理呢？特别是现在企业对海量大数据的传输，存储的重视，要求我们使用一定的技术处理这些数据差错。<br>##2.纠错编解码原理简单介绍</p>
</li>
<li><p>为什么纠错码具有发现错误!纠正错误的能力呢?纠错码又是按什么样的原理去编的呢?为了说明这些问题,我们首先介绍一些基本概念:由0和1组成的串称为字(Word),一些字的集合称为码(Code)。码中的字称为码字(Code Word)。不在码中的字称为废码(Invalid Code)。码中的每个二进制信号0或1称为码元(Code Letter)。             </p>
</li>
<li><p>我们下面举出几个关于纠错码的例子。设有长度为2的字,它们一共可有2x2=4个,力。因为当52中的一个字如10,在传递过程中其第一个码元1变为0,因而整个字成为00时,由于00也是52中的字,故我们不能发现传递中是否出错。但是,当我们选取52的一个子集如C2={00},作为编码时就会发生另一种完全不同的情况。因为此时01和10均为废码,而当H在传递过程中第一个码元由1变为0,即整个字成为01时,由于01是废码,因而我们发现传递过程中出现了错误。对00也有同样的情况。但是,这种编码有一个缺点,即它只能发现错误而不能纠正错误,因此我们还需要选择另一种能纠错的编码”现在我们考虑长度为3的字,它们一共可有2!3=8个,它们所组成的字集凡不仅能整个码字只会变为101!011或000,但是都可知其原码为001。对于码字110也有类似的情况”故对编码q,我们不仅能发现错误而且能纠正错误”当然,上述编码还有一个缺点,就是它只能发现并纠正单个错误。当错误超过两个码元时,它就既不能发现错误,更无法纠正了。<br>##3.Reed-Solomon 码（RS 码）原理</p>
</li>
<li><p>Reed-Solomon 码（RS 码）是 Reed和 Solomon于 1960 年发现的一类多元最大距离可分（MDS）码，其最小距离达到了 Singleton 限mind = n − k+ 1，从这个意义上讲，RS 码是最佳的。之后几十年里，RS 码的硬判决译码得到了深入的研究，其理论和技术都已经非常成熟。因而，RS码在现代数字通信、数据存储系统中得到了广泛的应用。<br>##4.Reed – Solomon编码抽象代数基础</p>
</li>
<li><p>4.1定义 设G是一个非空集合，称映射为G上的一个二元运算，即对于G中仍以两个元a和b，唯一确定 (a,b).记为,为了方便起见，可写成c=ab.<br>定义 设G是一个非空集合，是G上的一个二元运算，如果G满足下列条件：<br>a)（结合律）对于任意,有<br>b)（单位元）G中存在单位元，对于任意，满足<br>c)（逆元）对于任意，存在的逆元，满足<br>则称G为群，记为.<br>  如果群满足交换律，即对于任意，满足<br>则称群 为交换群或阿贝尔群.</p>
</li>
<li><p>4.2 环和域<br>定义 设R是一个非空集合，R上有两个二元运算和，分别成为加法和乘法，如果R满足下列条件<br>a)为加法阿贝尔群<br>b)（结合律）对于任意,有<br>c)（分配律）对于任意,有<br>  称R为环，记为，如果他对乘法满足交换律，即对任何<br>称环为交换环<br>  定义 设为交换环，表示R中所有非零元的集合，如果在乘法运算下构成交换群，则称为域。</p>
</li>
<li><p>4.3 有限域<br>定义 设F为一个域，如果F只含有有限个元素，称F为有限域，含有q个元素的有限域记为，有限域也成为伽罗华域(Galois field)，用GF(q)或表示q阶有限域。<br>最简单的有限域是二元域GF(2)={0,1}。<br>定义 对于GF(q)上的每个非零元素，存在最小整数k,使成立，则称为k阶元素。<br>定义 对于GF(q)上的每个非零元素，如果其阶数是q-1,则称为本原元素。<br>定义上的一个m次多项式，如果他的所有根都是中的本原元素，则称是m次本原多项式。<br>例如，对于m = 8时上的m次本原多项式为<br>对于m = 7时上的m次本原多项式为<br>  定义 设为中的元素，多项式是上使的最低次多项式，则称为最小多项式。具有相同最小多项式的元素，构成同一共轭系。</p>
</li>
<li><p>4.4 欧几里得算法<br>欧几里得算法给定两个正整数a,b，可以用欧几里得除法得到其最大公约数(a,b)，并求得A，B，满足(a,b)=Aa+Bb。<br>用欧几里得除法求(a,b)的步骤如下：<br>第一步：不失一般性，假设a&gt;b，且令<br>第二步：用除以得到其商数和余数，亦即<br>第三步：如果，停止运算，并记；否则，转第二步。<br>欧几里得算法又被称为辗转相除法，这里是单调下降序列。<br>用欧几里得算法可以求得A、B，沿用上述除法得到的和n，其方法如下：<br>第一步：令<br>第二步：计算<br>第三步：如果，停止运算，此时,否则转第二步<br>事实上，只是其中的一个特例。<br>##5.RS(255,223)编解码算法</p>
</li>
<li><p>5.1字节交织器<br><img src="http://img.blog.csdn.net/20180106152816595?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180106152928851?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
</li>
<li><p>5.2  RS(255,223,32)生成方式<br><img src="http://img.blog.csdn.net/20180106154825049?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180106155354311?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>##Github项目源码</p>
</li>
<li><p>GitHub链接：   <a target="_blank" rel="noopener" href="https://github.com/RobinLiew/Reed-Solomon-error-correction">https://github.com/RobinLiew/Reed-Solomon-error-correction</a></p>
</li>
<li><p>使用例子</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public class RSErrorCorrectionImpl implements IRSErrorCorrection &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private RSEncoder encoder&#x3D;new RSEncoder();</span><br><span class="line"></span><br><span class="line">private RSDecoder decoder&#x3D;new RSDecoder();</span><br><span class="line"></span><br><span class="line">public static Boolean isCanBeRecovered&#x3D;true;</span><br><span class="line"></span><br><span class="line">private byte[] temp&#x3D;new byte[233];</span><br><span class="line"></span><br><span class="line">private ByteBuffer buffer&#x3D;new ByteBuffer() ;</span><br><span class="line"></span><br><span class="line">private byte[] enTemp&#x3D;new byte[255];</span><br><span class="line"></span><br><span class="line">public byte[] rs_encode(byte[] data) &#123;</span><br><span class="line">	return encoder.encode(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public int rs_decode(byte[] recover, byte[] rsData) &#123;</span><br><span class="line">	byte[] result &#x3D; null;</span><br><span class="line">	result&#x3D;decoder.decode(rsData);</span><br><span class="line">	</span><br><span class="line">	if(!isCanBeRecovered)&#123;</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	System.arraycopy(result, 0, recover, 0, result.length);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">	</span><br><span class="line">	byte[] src&#x3D;new byte[223];</span><br><span class="line">	for(int i&#x3D;0;i&lt;223;i++)&#123;</span><br><span class="line">		src[i]&#x3D;(byte) new Random().nextInt(255);</span><br><span class="line">	&#125;</span><br><span class="line">	byte[] srcdouble&#x3D;new byte[446];</span><br><span class="line">	for(int i&#x3D;0;i&lt;2;i++)&#123;</span><br><span class="line">		System.arraycopy(src, 0, srcdouble, i*223, 223);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	IRSErrorCorrection error &#x3D; new RSErrorCorrectionImpl();</span><br><span class="line">	byte[] en_data&#x3D;error.rs_encode(srcdouble);</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F;Deliberately mistaken the values of several data(故意弄错几个数据的值)</span><br><span class="line">	en_data[0]&#x3D;0;</span><br><span class="line">	en_data[1]&#x3D;4;</span><br><span class="line">	en_data[3]&#x3D;0;</span><br><span class="line">	&#x2F;&#x2F;byte[] recover &#x3D; new byte[src.length];</span><br><span class="line">	byte[] recover &#x3D; new byte[srcdouble.length];</span><br><span class="line">	int flag &#x3D; error.rs_decode(recover,en_data);</span><br><span class="line">	</span><br><span class="line">    </span><br><span class="line">    System.out.println(&quot;completion of the test！！！&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/算法/基于BP神经元网络算法的模式识别/">BP神经元网络算法</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <p>这是以前自己读研时的一个比较简单的项目，分享出来，希望能帮到一些对神经网络和模式识别感兴趣的人。<br>#基于BP神经元网络算法的模式识别</p>
<h2 id="BP神经元网络算法"><a href="#BP神经元网络算法" class="headerlink" title="BP神经元网络算法"></a>BP神经元网络算法</h2><ul>
<li>神经网络是对人脑或自然神经网络的若干基本特性的抽象，是一种基于连接假说构造的智能仿生模型，人们试图通过对它的研究最终揭开人脑的奥秘，建立起能模拟人脑功能和结构的智能系统，使计算机能够像人脑那样进行信息处理。本文主要用基于BP神经元网络算法进行模式识别[11]。</li>
<li>我们以三层BP网络为例，介绍该算法。它的结构如图 所示，包含一个输入层、一个隐含层和一个输出层，分别由个n,p,q神经元组成。BP神经网络结构如图8所示。<br><img src="http://img.blog.csdn.net/20180106170902782?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180106170911991?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180106170925763?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20180106170939702?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"> </li>
</ul>
<p>##GitHub项目源码</p>
<ul>
<li>GitHub链接：<a target="_blank" rel="noopener" href="https://github.com/RobinLiew/wireless-communication">https://github.com/RobinLiew/wireless-communication</a>  这里面有测试数据，详细的介绍文档，源码，介绍了利用BP神经元网络算法对无线信道进行模式识别的案例。</li>
<li>核心源码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">function  Bpmodeldistinguish( X,Y )</span><br><span class="line"></span><br><span class="line">%*****************************************************</span><br><span class="line">%利用matalb实现基于BP神经网络模式识别实现代码</span><br><span class="line">%*****************************************************</span><br><span class="line"></span><br><span class="line">% X是三个场景的平均特征向量所组成的矩阵（就是fea_average）</span><br><span class="line">% Y是待匹配的特征向量（就是b1或b2）</span><br><span class="line">%**************************************************************************</span><br><span class="line">%**************** 先对X和Y进行标准化处理 *******************</span><br><span class="line">%**************************************************************************</span><br><span class="line">X&#x3D;[1e9*X(1,:);1e3*X(2,:);X(3,:)&#x2F;100];</span><br><span class="line">X&#x3D;X&#39;;</span><br><span class="line">X0&#x3D;ones(3,16);</span><br><span class="line">X0(:,[1:3])&#x3D;X;</span><br><span class="line">X&#x3D;X0;</span><br><span class="line">Y&#x3D;[1e9*Y(1);1e3*Y(2);Y(3)&#x2F;100];</span><br><span class="line">Y&#x3D;Y&#39;;</span><br><span class="line">Y0&#x3D;ones(1,16);</span><br><span class="line">Y0(1:3)&#x3D;Y;</span><br><span class="line">Y&#x3D;Y0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%**************************************************************************</span><br><span class="line">%*******************主函数main*********************************************</span><br><span class="line">%*************************START********************************************</span><br><span class="line">%**************************************************************************</span><br><span class="line">Y1&#x3D;[1 0 0];      %输出模式           </span><br><span class="line">Y2&#x3D;[0 1 0];</span><br><span class="line">Y3&#x3D;[0 0 1];</span><br><span class="line">Yo&#x3D;[Y1;Y2;Y3]; %输出的三种模式</span><br><span class="line">n&#x3D;16; %输入层神经元个数</span><br><span class="line">p&#x3D;8;  %中间层神经元个数</span><br><span class="line">q&#x3D;3;  %输出神经元个数</span><br><span class="line">k&#x3D;3 ;%训练模式个数</span><br><span class="line">a1&#x3D;0.2; b1&#x3D;0.2; %学习系数，</span><br><span class="line">%rou&#x3D;0.5;%动量系数，</span><br><span class="line">emax&#x3D;0.01; cntmax&#x3D;100;%最大误差，训练次数</span><br><span class="line">[w,v,theta,r,t,mse]&#x3D;bptrain(n,p,q,X,Yo,k,emax,cntmax,a1,b1);%调用函数bptrain训练网络</span><br><span class="line">c&#x3D;bptest(p,q,n,w,v,theta,r,Y);</span><br><span class="line">c(c&gt;0.5)&#x3D;1;</span><br><span class="line">c(c&lt;0.2)&#x3D;0;</span><br><span class="line">disp(&#39;测试数据的识别结果:&#39;)</span><br><span class="line">c</span><br><span class="line">if (min(c&#x3D;&#x3D;Y1)&#x3D;&#x3D;1)</span><br><span class="line">    fprintf(&#39;该数据和场景1匹配\n&#39;);</span><br><span class="line">elseif (min(c&#x3D;&#x3D;Y2)&#x3D;&#x3D;1)</span><br><span class="line">        fprintf(&#39;该数据和场景2匹配\n&#39;);</span><br><span class="line">else</span><br><span class="line">        fprintf(&#39;该数据和场景3匹配\n&#39;);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">%**************************************************************************</span><br><span class="line">%**************************END*********************************************</span><br><span class="line">%**************************************************************************</span><br><span class="line"></span><br><span class="line">    function [w,v,theta,r,t,mse]&#x3D;bptrain(n,p,q,X,Yo,k,emax,cntmax,a1,b1)</span><br><span class="line">%n表示输入神经元个数,p表示中间层神经元个数，q表示输出神经元个数,</span><br><span class="line">%X表示输入训练模式，Yo表示标准输出，k表示训练模式的个数</span><br><span class="line">%emax表示最大误差，cntmax表示最大训练次数，a1，b1表示学习系数，rou表示动量系数</span><br><span class="line">%w、theta表示训练结束后输入层与中间层连接权系数和阈值，</span><br><span class="line">%v、r表示训练结束后中间层与输出层连接权和阈值</span><br><span class="line">%t表示训练时间</span><br><span class="line">tic</span><br><span class="line">w&#x3D;rands(n,p);%输入层与隐含层连接权</span><br><span class="line">v&#x3D;rands(p,q); %隐含层与输出层连接权</span><br><span class="line">theta&#x3D;rands(1,p);%中间层的阈值</span><br><span class="line">r&#x3D;rands(1,q);%输出层的阈值</span><br><span class="line">cnt&#x3D;1;</span><br><span class="line">mse&#x3D;zeros(1,cntmax);%全局误差为零</span><br><span class="line">er&#x3D;0;</span><br><span class="line">while ((er&gt;emax)|(cnt&lt;&#x3D;cntmax))</span><br><span class="line"> E&#x3D;zeros(1,q);</span><br><span class="line"> %循环识别模式  </span><br><span class="line"> for cp&#x3D;1:k</span><br><span class="line">     X0&#x3D;X(cp,:);             </span><br><span class="line">     Y0&#x3D;Yo(cp,:);</span><br><span class="line"></span><br><span class="line">     %计算中间层的输入Y(j) </span><br><span class="line">     Y&#x3D;X0*w; </span><br><span class="line">     %计算中间层的输出b</span><br><span class="line">     Y&#x3D;Y-theta;    %中间层阈值</span><br><span class="line">     for j&#x3D;1:p</span><br><span class="line">         b(j)&#x3D;1&#x2F;(1+exp(-Y(j)));%中间层输出f(sj)</span><br><span class="line">     end      </span><br><span class="line">    %计算输出层输出c</span><br><span class="line">             Y&#x3D;b*v;</span><br><span class="line">             Y&#x3D;Y-r;  % 输出层阈值</span><br><span class="line">        for t&#x3D;1:q</span><br><span class="line">           c(t)&#x3D;1&#x2F;(1+exp(-Y(t))); %输出层输出</span><br><span class="line">        end </span><br><span class="line">    %计算输出层校正误差d</span><br><span class="line">        for t&#x3D;1:q </span><br><span class="line">          d(t)&#x3D;(Y0(t)-c(t))*c(t)*(1-c(t));</span><br><span class="line">        end</span><br><span class="line">   %计算中间层校正误差e</span><br><span class="line">         xy&#x3D;d*v&#39;;</span><br><span class="line">         for t&#x3D;1:p</span><br><span class="line">           e(t)&#x3D;xy(t)*b(t)*(1-b(t));</span><br><span class="line">         end</span><br><span class="line">   %计算下一次的中间层和输出层之间新的连接权v(i,j),阈值t2(j)</span><br><span class="line">          for t&#x3D;1:q</span><br><span class="line">              for j&#x3D;1:p</span><br><span class="line">                  v(j,t)&#x3D;v(j,t)+a1*d(t)*b(j);</span><br><span class="line">              end</span><br><span class="line">              r(t)&#x3D;r(t)+a1*d(t);</span><br><span class="line">          end</span><br><span class="line">      %计算下一次的输入层和中间层之间新的连接权w(i,j),阈值t1(j)</span><br><span class="line">           for j&#x3D;1:p</span><br><span class="line">              for i&#x3D;1:n</span><br><span class="line">                  w(i,j)&#x3D;w(i,j)+b1*e(j)*X0(i);</span><br><span class="line">              end</span><br><span class="line">              theta(j)&#x3D;theta(j)+b1*e(j);</span><br><span class="line">           end</span><br><span class="line">           for t&#x3D;1:q</span><br><span class="line">               E(cp)&#x3D;(Y0(t)-c(t))*(Y0(t)-c(t))+E(cp);%求当前学习模式的全局误差</span><br><span class="line">           end</span><br><span class="line">           E(cp)&#x3D;E(cp)*0.5;</span><br><span class="line">    %输入下一模式    </span><br><span class="line">  end</span><br><span class="line">  er&#x3D;sum(E);%计算全局误差</span><br><span class="line">  mse(cnt)&#x3D;er;</span><br><span class="line">  cnt&#x3D;cnt+1;%更新学习次数</span><br><span class="line"> end</span><br><span class="line">t&#x3D;toc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function c&#x3D;bptest(p,q,n,w,v,theta,r,X)</span><br><span class="line">%p,q,n表示输入层、中间层和输出层神经元个数</span><br><span class="line">%w，v表示训练好的神经网络输入层到中间层、中间层到输出层权值。</span><br><span class="line">%X为输入测试的模式</span><br><span class="line">%c表示模式X送入神经网络的识别结果。</span><br><span class="line">%计算中间层的输入Y(j) </span><br><span class="line">Y&#x3D;X*w; </span><br><span class="line">%计算中间层的输出b</span><br><span class="line">Y&#x3D;Y-theta;    %中间层阈值</span><br><span class="line">for j&#x3D;1:p</span><br><span class="line">    b(j)&#x3D;1&#x2F;(1+exp(-Y(j)));%中间层输出f(sj)</span><br><span class="line">end      </span><br><span class="line">%计算输出层输出c</span><br><span class="line">Y&#x3D;b*v;</span><br><span class="line">Y&#x3D;Y-r;  % 输出层阈值</span><br><span class="line">thr1&#x3D;0.01;thr2&#x3D;0.5;</span><br><span class="line">for t&#x3D;1:q</span><br><span class="line">   c(t)&#x3D;1&#x2F;(1+exp(-Y(t))); %输出层输出</span><br><span class="line">end </span><br></pre></td></tr></table></figure>
      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/AngularJS/AngularJS基础/">AngularJS基础</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <p>最近开发一个项目用到AngularJS，作为一个java后端程序员，有点赶鸭子上架的赶脚，万幸AngularJS这个前端框架上手比较快，我参照 <a target="_blank" rel="noopener" href="http://www.runoob.com/angularjs/angularjs-tutorial.html">http://www.runoob.com/angularjs/angularjs-tutorial.html</a> 网站上的教程进行学习，并对其进行笔记总结，加深记忆。</p>
<h3 id="1-AngularJS基本介绍"><a href="#1-AngularJS基本介绍" class="headerlink" title="1.AngularJS基本介绍"></a>1.AngularJS基本介绍</h3><h4 id="AngularJS是什么？"><a href="#AngularJS是什么？" class="headerlink" title="AngularJS是什么？"></a>AngularJS是什么？</h4><p>AngularJS是谷歌的一块前端JS框架。它是一个以 JavaScript 编写的库，是为了克服HTML在构建应用上的不足而设计的。它有着诸多的核心特性：MVC、模块化、自动化双向数据绑定、语义化标签、依赖注入等等。如果你和我一样是Java后端程序员的话，相信对MVC，依赖注入等特性会很耳熟，学习起来也很容易。AngularJS弥补了HTML在构建应用方面的不足，使开发者可以使用HTML来声明动态内容，从而使得Web开发和测试工作变得更加容易。</p>
<h4 id="AngularJS能做什么？"><a href="#AngularJS能做什么？" class="headerlink" title="AngularJS能做什么？"></a>AngularJS能做什么？</h4><ul>
<li>AngularJS 使得开发现代的单一页面应用程序（SPAs：Single Page Applications）变得更加容易。<br>AngularJS擅长构建一个CRUD（增加Create、查询Retrieve、更新Update、删除Delete）的应用<ul>
<li>AngularJS 把应用程序数据绑定到 HTML 元素。</li>
<li>AngularJS 可以克隆和重复 HTML 元素。</li>
<li>AngularJS 可以隐藏和显示 HTML 元素。</li>
<li>AngularJS 可以在 HTML 元素”背后”添加代码。</li>
<li>AngularJS 支持输入验证。<h3 id="2-Angular基础（一）"><a href="#2-Angular基础（一）" class="headerlink" title="2.Angular基础（一）"></a>2.Angular基础（一）</h3></li>
</ul>
</li>
</ul>
<h4 id="AngularJS指令"><a href="#AngularJS指令" class="headerlink" title="AngularJS指令"></a>AngularJS指令</h4><ul>
<li>AngularJS 通过 ng-directives 扩展了 HTML。<ul>
<li>创建模块：你可以通过 AngularJS 的 angular.module 函数来创建模块</li>
<li>添加控制器：你可以使用 ng-controller 指令来添加应用的控制器</li>
<li>添加指令：使用directive来为你应用添加自己的指令</li>
</ul>
</li>
<li>ng-app 指令定义一个 AngularJS 应用程序。</li>
<li>ng-model 指令把元素值（比如输入域的值）绑定到应用程序。<br>  ng-model 指令可以将输入域的值与 AngularJS 创建的变量绑定。<ul>
<li>1.双向绑定：在修改输入域的值时， AngularJS 属性的值也将修改</li>
</ul>
</li>
</ul>
<pre><code>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;</span><br><span class="line">    名字: &lt;input ng-model&#x3D;&quot;name&quot;&gt;</span><br><span class="line">    &lt;h1&gt;你输入了: &#123;&#123;name&#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>
- 2.验证用户输入


    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form ng-app&#x3D;&quot;&quot; name&#x3D;&quot;myForm&quot;&gt;</span><br><span class="line">    Email:</span><br><span class="line">    &lt;input type&#x3D;&quot;email&quot; name&#x3D;&quot;myAddress&quot; ng-model&#x3D;&quot;text&quot;&gt;</span><br><span class="line">    &lt;span ng-show&#x3D;&quot;myForm.myAddress.$error.email&quot;&gt;不是一个合法的邮箱地址&lt;&#x2F;span&gt;</span><br><span class="line">    &lt;!-- 提示信息会在 ng-show 属性返回 true 的情况下显示 --&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">一个完整的验证实例：</span><br><span class="line"> &lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;apps.bdimg.com&#x2F;libs&#x2F;angular.js&#x2F;1.4.6&#x2F;angular.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h2&gt;Validation Example&lt;&#x2F;h2&gt;</span><br><span class="line"></span><br><span class="line">&lt;form  ng-app&#x3D;&quot;myApp&quot;  ng-controller&#x3D;&quot;validateCtrl&quot;</span><br><span class="line">name&#x3D;&quot;myForm&quot; novalidate&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;用户名:&lt;br&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;user&quot; ng-model&#x3D;&quot;user&quot; required&gt;</span><br><span class="line">  &lt;span style&#x3D;&quot;color:red&quot; ng-show&#x3D;&quot;myForm.user.$dirty &amp;&amp; myForm.user.$invalid&quot;&gt;</span><br><span class="line">  &lt;span ng-show&#x3D;&quot;myForm.user.$error.required&quot;&gt;用户名是必须的。&lt;&#x2F;span&gt;</span><br><span class="line">  &lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;邮箱:&lt;br&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;email&quot; name&#x3D;&quot;email&quot; ng-model&#x3D;&quot;email&quot; required&gt;</span><br><span class="line">  &lt;span style&#x3D;&quot;color:red&quot; ng-show&#x3D;&quot;myForm.email.$dirty &amp;&amp; myForm.email.$invalid&quot;&gt;</span><br><span class="line">  &lt;span ng-show&#x3D;&quot;myForm.email.$error.required&quot;&gt;邮箱是必须的。&lt;&#x2F;span&gt;</span><br><span class="line">  &lt;span ng-show&#x3D;&quot;myForm.email.$error.email&quot;&gt;非法的邮箱。&lt;&#x2F;span&gt;</span><br><span class="line">  &lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;submit&quot;</span><br><span class="line">  ng-disabled&#x3D;&quot;myForm.user.$dirty &amp;&amp; myForm.user.$invalid ||</span><br><span class="line">  myForm.email.$dirty &amp;&amp; myForm.email.$invalid&quot;&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;validateCtrl&#39;, function($scope) &#123;</span><br><span class="line">    $scope.user &#x3D; &#39;John Doe&#39;;</span><br><span class="line">    $scope.email &#x3D; &#39;john.doe@gmail.com&#39;;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt; </span><br></pre></td></tr></table></figure>
- 3.应用状态

    ng-model 指令可以为应用数据提供状态值(invalid, dirty, touched, error):


    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;form ng-app&#x3D;&quot;&quot; name&#x3D;&quot;myForm&quot; ng-init&#x3D;&quot;myText &#x3D; &#39;test@runoob.com&#39;&quot;&gt;</span><br><span class="line">    Email:</span><br><span class="line">    &lt;input type&#x3D;&quot;email&quot; name&#x3D;&quot;myAddress&quot; ng-model&#x3D;&quot;myText&quot; required&gt;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;h1&gt;状态&lt;&#x2F;h1&gt;</span><br><span class="line">    &#123;&#123;myForm.myAddress.$valid&#125;&#125;</span><br><span class="line">    &#123;&#123;myForm.myAddress.$dirty&#125;&#125;</span><br><span class="line">    &#123;&#123;myForm.myAddress.$touched&#125;&#125;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">	下面这些验证的值为布尔类型，可以结合控制器进行非常灵活的操作</span><br><span class="line">	ng-valid: 验证通过</span><br><span class="line">	ng-invalid: 验证失败</span><br><span class="line">	ng-valid-[key]: 由$setValidity添加的所有验证通过的值</span><br><span class="line">	ng-invalid-[key]: 由$setValidity添加的所有验证失败的值</span><br><span class="line">	ng-pristine: 控件为初始状态</span><br><span class="line">	ng-dirty: 控件输入值已变更</span><br><span class="line">	ng-touched: 控件已失去焦点</span><br><span class="line">	ng-untouched: 控件未失去焦点</span><br><span class="line">	ng-pending: 任何为满足$asyncValidators的情况</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
- 4.CSS 类
    ng-model 指令基于它们的状态为 HTML 元素提供了 CSS 类


    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;style&gt;</span><br><span class="line">	input.ng-invalid &#123;</span><br><span class="line">	    background-color: lightblue;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">	&lt;form ng-app&#x3D;&quot;&quot; name&#x3D;&quot;myForm&quot;&gt;</span><br><span class="line">	    输入你的名字:</span><br><span class="line">	    &lt;input name&#x3D;&quot;myAddress&quot; ng-model&#x3D;&quot;text&quot; required&gt;</span><br><span class="line">	&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure></code></pre>
<ul>
<li>ng-bind 指令把应用程序数据绑定到 HTML 视图。</li>
</ul>
<pre><code>- 实现数据绑定
    通过数据绑定同步了AngularJS数据与表达式
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;!-- 这里AngularJS库可以下载下来引入，下载地址为https:&#x2F;&#x2F;github.com&#x2F;angular&#x2F;angular.js&#x2F;releases --&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;...&#x2F;angular.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div ng-app&#x3D;&quot;&quot;&gt;</span><br><span class="line">     &lt;p&gt;名字 : &lt;input type&#x3D;&quot;text&quot; ng-model&#x3D;&quot;name&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">     &lt;h1&gt;Hello &#123;&#123;name&#125;&#125;&lt;&#x2F;h1&gt; &lt;!-- 双括号为AngularJS 表达式 --&gt;</span><br><span class="line">     &lt;!-- 注意，这里把上面的元素h1换成&lt;h1 ng-bind&#x3D;&quot;firstName&quot;&gt;&lt;&#x2F;h1&gt; 效果是一样的 --&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
    运行结果如下图所示，数据传入ng-model的变量name中，通过表达式在h1元素中显示出来。
![这里写图片描述](http://img.blog.csdn.net/20180308084500101?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
说明：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;!-- 这里AngularJS库可以下载下来引入，下载地址为https:&#x2F;&#x2F;github.com&#x2F;angular&#x2F;angular.js&#x2F;releases --&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;...&#x2F;angular.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">下面如果不做特殊说明的话，所有的HTML元素代码片段都是要放入这里运行，为了简化代码，以下的片段就不重复写这些了。</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure></code></pre>
<ul>
<li><p>ng-repeat指令：会重复一个 HTML 元素</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">&lt;div ng-app&#x3D;&quot;&quot; ng-init&#x3D;&quot;names&#x3D;[&#39;Jani&#39;,&#39;Hege&#39;,&#39;Kai&#39;]&quot;&gt;</span><br><span class="line">	&lt;p&gt;使用 ng-repeat 来循环数组&lt;&#x2F;p&gt;</span><br><span class="line">	&lt;ul&gt;</span><br><span class="line">	    &lt;li ng-repeat&#x3D;&quot;x in names&quot;&gt;</span><br><span class="line">	      &#123;&#123; x &#125;&#125;</span><br><span class="line">	    &lt;&#x2F;li&gt;</span><br><span class="line">	&lt;&#x2F;ul&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>  运行结果如下所示：</code></pre>
<p>  <img src="http://img.blog.csdn.net/20180308093426552?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>  ng-repeat 指令用在一个对象数组上：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">&lt;div ng-app&#x3D;&quot;&quot; ng-init&#x3D;&quot;names&#x3D;[</span><br><span class="line">&#123;name:&#39;Jani&#39;,country:&#39;Norway&#39;&#125;,</span><br><span class="line">&#123;name:&#39;Hege&#39;,country:&#39;Sweden&#39;&#125;,</span><br><span class="line">&#123;name:&#39;Kai&#39;,country:&#39;Denmark&#39;&#125;]&quot;&gt;</span><br><span class="line">	 </span><br><span class="line">&lt;p&gt;循环对象：&lt;&#x2F;p&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">	 &lt;li ng-repeat&#x3D;&quot;x    in names&quot;&gt;</span><br><span class="line">	   &#123;&#123; x.name + &#39;, &#39; + x.country &#125;&#125;</span><br><span class="line">	 &lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br><span class="line">	 </span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>  运行结果：</p>
</li>
</ul>
<p><img src="http://img.blog.csdn.net/20180308093721519?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1YmluMTk5MWxpdWJpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<ul>
<li><p>创建自定义的指令<br>  除了 AngularJS 内置的指令外，我们还可以创建自定义指令。<br>  你可以使用 .directive 函数来添加自定义的指令。<br>  要调用自定义指令，HTML 元素上需要添加自定义指令名。<br>  使用驼峰法来命名一个指令， runoobDirective, 但在使用它时需要以 - 分割, runoob-directive:<br>  且你可以通过元素名、属性、类名、注释来调用指令。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;body ng-app&#x3D;&quot;myApp&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;runoob-directive&gt;&lt;&#x2F;runoob-directive&gt;&lt;!-- 元素名 --&gt;</span><br><span class="line">&lt;!-- &lt;div runoob-directive&gt;&lt;&#x2F;div&gt; --&gt; &lt;!-- 属性 --&gt;</span><br><span class="line">&lt;!-- &lt;div class&#x3D;&quot;runoob-directive&quot;&gt;&lt;&#x2F;div&gt; --&gt; &lt;!-- 类名 --&gt;</span><br><span class="line">&lt;!-- &lt;!-- directive: runoob-directive --&gt; --&gt; &lt;!-- 注释 --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	var app &#x3D; angular.module(&quot;myApp&quot;, []);</span><br><span class="line">	app.directive(&quot;runoobDirective&quot;, function() &#123;</span><br><span class="line">	    return &#123;</span><br><span class="line">		  &#x2F;*restrict : &quot;A&quot;,*&#x2F;  </span><br><span class="line">	        template : &quot;&lt;h1&gt;自定义指令!&lt;&#x2F;h1&gt;&quot;</span><br><span class="line">	    &#125;;</span><br><span class="line">	&#125;);</span><br><span class="line">	&#x2F;*</span><br><span class="line">	过添加 restrict 属性,并设置值为 &quot;A&quot;, 来设置指令只能通过属性的方式来调用</span><br><span class="line">	restrict 值可以是以下几种:</span><br><span class="line"></span><br><span class="line">	    E 作为元素名使用</span><br><span class="line">	    A 作为属性使用</span><br><span class="line">	    C 作为类名使用</span><br><span class="line">	    M 作为注释使用</span><br><span class="line">	</span><br><span class="line">	restrict 默认值为 EA, 即可以通过元素名和属性名来调用指令</span><br><span class="line">	*&#x2F;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="AngularJS-表达式"><a href="#AngularJS-表达式" class="headerlink" title="AngularJS 表达式"></a>AngularJS 表达式</h4><p>AngularJS 表达式写在双大括号内：。<br>AngularJS 表达式把数据绑定到 HTML，这与 ng-bind 指令有异曲同工之妙。<br>AngularJS 将在表达式书写的位置”输出”数据。<br>AngularJS 表达式 很像 JavaScript 表达式：它们可以包含文字、运算符和变量。<br>实例 10 或 undefined undefined</p>
<ul>
<li><p>1.AngularJS 数字：AngularJS 数字就像 JavaScript 数字</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  注意：ng-init在初始化数据时并不常用，后面会使用控制器模块代替它的方法--&gt;</span><br><span class="line">&lt;div ng-app&#x3D;&quot;&quot; ng-init&#x3D;&quot;quantity&#x3D;1;cost&#x3D;5&quot;&gt;</span><br><span class="line"> &lt;!-- 双大括号内会直接计算出两个变量的乘积，并显示在页面上 --&gt;</span><br><span class="line">&lt;p&gt;总价： &#123;&#123; quantity * cost &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.AngularJS 字符串：AngularJS 字符串就像 JavaScript 字符串</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div ng-app&#x3D;&quot;&quot; ng-init&#x3D;&quot;firstName&#x3D;&#39;John&#39;;lastName&#x3D;&#39;Doe&#39;&quot;&gt;</span><br><span class="line"> </span><br><span class="line">&lt;p&gt;姓名： &#123;&#123; firstName + &quot; &quot; + lastName &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></code></pre>
<ul>
<li>3.AngularJS 对象：AngularJS 对象就像 JavaScript 对象</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app&#x3D;&quot;&quot; ng-init&#x3D;&quot;person&#x3D;&#123;firstName:&#39;John&#39;,lastName:&#39;Doe&#39;&#125;&quot;&gt;</span><br><span class="line"> </span><br><span class="line">&lt;p&gt;姓为 &#123;&#123; person.lastName &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></code></pre>
<ul>
<li>4.AngularJS 数组：AngularJS 数组就像 JavaScript 数组</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div ng-app&#x3D;&quot;&quot; ng-init&#x3D;&quot;points&#x3D;[1,15,19,2,40]&quot;&gt;</span><br><span class="line"> </span><br><span class="line">&lt;p&gt;第三个值为 &#123;&#123; points[2] &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
 注意AngularJS数字、字符串、对象写法的区别。
    - 数字和字符串都是包裹在&quot; &quot;中，
    - 对象的写法为  对象名=&#123;...&#125;，
    - 数组的写法为  数组名=[...]</code></pre>
<h4 id="AngularJS-应用"><a href="#AngularJS-应用" class="headerlink" title="AngularJS 应用"></a>AngularJS 应用</h4><p>AngularJS 模块（Module） 定义了 AngularJS 应用。<br>AngularJS 控制器（Controller） 用于控制 AngularJS 应用。<br>ng-app指令指明了应用, ng-controller 指明了控制器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 要运行的话把这段代码放入完整的HTML页面的body元素中 --&gt;</span><br><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;</span><br><span class="line"> </span><br><span class="line">名: &lt;input type&#x3D;&quot;text&quot; ng-model&#x3D;&quot;firstName&quot;&gt;&lt;br&gt;</span><br><span class="line">姓: &lt;input type&#x3D;&quot;text&quot; ng-model&#x3D;&quot;lastName&quot;&gt;&lt;br&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">姓名: &#123;&#123;firstName + &quot; &quot; + lastName&#125;&#125;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);&#x2F;&#x2F;定义AngularJS模块</span><br><span class="line">&#x2F;&#x2F;使用AngularJS控制器控制应用</span><br><span class="line">app.controller(&#39;myCtrl&#39;, function($scope) &#123;</span><br><span class="line">    $scope.firstName&#x3D; &quot;John&quot;;</span><br><span class="line">    $scope.lastName&#x3D; &quot;Doe&quot;;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>AngularJS加载多个ng-app<br>  上面的例子中，我们发现ng-app只出现了一次，如果出现多次会怎么样呢？<br>   ng-app是一个特殊的指令，一个HTML文档只出现一次，如出现多次也只有第一个起作用；除非我们手动加载除第一个ng-app外的其他ng-app。<br>   ng-app可以出现在html文档的任何一个元素上。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;h1&gt;姓氏为 &#123;&#123;lastname&#125;&#125; 家族成员:&lt;&#x2F;h1&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;ul&gt;  </span><br><span class="line">    &lt;li ng-repeat&#x3D;&quot;x in names&quot;&gt;&#123;&#123;x&#125;&#125; &#123;&#123;lastname&#125;&#125;&lt;&#x2F;li&gt;  </span><br><span class="line">&lt;&#x2F;ul&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;&#x2F;div&gt;  </span><br><span class="line">      </span><br><span class="line">&lt;div id&#x3D;&quot;myApp2&quot; ng-app&#x3D;&quot;myApp2&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;  </span><br><span class="line">&lt;h1&gt;myApp2 姓氏为 &#123;&#123;lastname&#125;&#125; 家族成员:&lt;&#x2F;h1&gt;  </span><br><span class="line">&lt;ul&gt;  </span><br><span class="line">    &lt;li ng-repeat&#x3D;&quot;x in names&quot;&gt;&#123;&#123;x&#125;&#125;&lt;&#x2F;li&gt;  </span><br><span class="line">&lt;&#x2F;ul&gt;  </span><br><span class="line">&lt;&#x2F;div&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;div id&#x3D;&quot;myApp3&quot; ng-app&#x3D;&quot;myApp3&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;  </span><br><span class="line">&lt;h1&gt;myApp3 姓氏为 &#123;&#123;lastname&#125;&#125; 家族成员:&lt;&#x2F;h1&gt;  </span><br><span class="line">&lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;rootScope共享&quot; ng-click&#x3D;&quot;say()&quot;&gt;  </span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	var app &#x3D; angular.module(&#39;myApp&#39;, []);  </span><br><span class="line">	app.controller(&#39;myCtrl&#39;, function($scope, $rootScope) &#123;  </span><br><span class="line">	    $scope.names &#x3D; [&quot;Emil&quot;, &quot;Tobias&quot;, &quot;Linus&quot;];  </span><br><span class="line">	    &#x2F;&#x2F;$rootScope.lastname &#x3D; &quot;Refsnes&quot;;  </span><br><span class="line">	&#125;);  </span><br><span class="line">	      </span><br><span class="line">	var app2 &#x3D; angular.module(&#39;myApp2&#39;, []);  </span><br><span class="line">	app2.controller(&#39;myCtrl&#39;, function($scope, $rootScope) &#123;  </span><br><span class="line">	        $scope.names &#x3D; [&quot;Emil2&quot;, &quot;Tobias2&quot;, &quot;Linus2&quot;];  </span><br><span class="line">	    $rootScope.lastname &#x3D; &quot;Refsnes--2&quot;;  </span><br><span class="line">	&#125;);  </span><br><span class="line">	  </span><br><span class="line">	var app3 &#x3D; angular.module(&#39;myApp3&#39;, []);  </span><br><span class="line">	app3.controller(&#39;myCtrl&#39;, function($scope, $rootScope) &#123;  </span><br><span class="line">	    $rootScope.lastname &#x3D; &quot;Refsnes--3&quot;;  </span><br><span class="line">	    $rootScope.say &#x3D; function()&#123;  </span><br><span class="line">	            $rootScope.lastname &#x3D; &quot;Refsnes---&quot;;  </span><br><span class="line">	        &#125;  </span><br><span class="line">	&#125;);  </span><br><span class="line">	  </span><br><span class="line">	&#x2F;&#x2F;手动加载myApp2 ng-app  </span><br><span class="line">	angular.bootstrap(document.getElementById(&quot;myApp2&quot;), [&#39;myApp2&#39;]);  </span><br><span class="line">	angular.bootstrap(document.getElementById(&quot;myApp3&quot;), [&#39;myApp3&#39;]);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Scope-作用域"><a href="#Scope-作用域" class="headerlink" title="Scope(作用域)"></a>Scope(作用域)</h4><p>AngularJS 应用组成如下：</p>
<pre><code>View(视图), 即 HTML。
Model(模型), 当前视图中可用的数据。
Controller(控制器), 即 JavaScript 函数，可以添加或修改属性。</code></pre>
<ul>
<li>scope 是模型。<br>scope 是一个 JavaScript 对象，带有属性和方法，这些属性和方法可以在视图和控制器中使用</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;</span><br><span class="line">		</span><br><span class="line">	&lt;h1&gt;&#123;&#123;carname&#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">		</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">		</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">			</span><br><span class="line">	app.controller(&#39;myCtrl&#39;, function($scope) &#123;</span><br><span class="line">		$scope.carname &#x3D; &quot;Volvo&quot;;</span><br><span class="line">	&#125;);</span><br><span class="line">	&#x2F;*</span><br><span class="line">		当在控制器中添加 $scope 对象时，视图 (HTML) 可以获取了这些属性。</span><br><span class="line">		视图中，你不需要添加 $scope 前缀, 只需要添加属性名即可，如： &#123;&#123;carname&#125;&#125;</span><br><span class="line">	*&#x2F;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">		</span><br></pre></td></tr></table></figure></code></pre>
<ul>
<li><p>根作用域<br>  所有的应用都有一个 $rootScope，它可以作用在 ng-app 指令包含的所有 HTML 元素中。<br>$rootScope 可作用于整个应用中。是各个 controller 中 scope 的桥梁。用 rootscope 定义的值，可以在各个 controller 中使用。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;&#123;&#123;lastname&#125;&#125; 家族成员:&lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li ng-repeat&#x3D;&quot;x in names&quot;&gt;&#123;&#123;x&#125;&#125; &#123;&#123;lastname&#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line"></span><br><span class="line">app.controller(&#39;myCtrl&#39;, function($scope, $rootScope) &#123;</span><br><span class="line">    $scope.names &#x3D; [&quot;Emil&quot;, &quot;Tobias&quot;, &quot;Linus&quot;];</span><br><span class="line">    $rootScope.lastname &#x3D; &quot;Refsnes&quot;;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="AngularJS-控制器"><a href="#AngularJS-控制器" class="headerlink" title="AngularJS 控制器"></a>AngularJS 控制器</h4></li>
<li><p>AngularJS 控制器 控制 AngularJS 应用程序的数据.<br>AngularJS 控制器是常规的 JavaScript 对象。AngularJS 使用$scope 对象来调用控制器。在 AngularJS 中， $scope 是一个应用对象(属于应用变量和函数)。控制器的 $scope （相当于作用域、控制范围）用来保存AngularJS Model(模型)的对象</p>
</li>
<li><p>在大型的应用程序中，通常是把控制器存储在外部文件中。只需要把 script 标签中的代码复制到名为xxx.js 的外部文件中即可</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;personCtrl&quot;&gt;</span><br><span class="line"></span><br><span class="line">名: &lt;input type&#x3D;&quot;text&quot; ng-model&#x3D;&quot;firstName&quot;&gt;&lt;br&gt;</span><br><span class="line">姓: &lt;input type&#x3D;&quot;text&quot; ng-model&#x3D;&quot;lastName&quot;&gt;&lt;br&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">姓名: &#123;&#123;fullName()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;personCtrl&#39;, function($scope) &#123;</span><br><span class="line">    $scope.firstName &#x3D; &quot;John&quot;;   &#x2F;&#x2F;控制器属性</span><br><span class="line">    $scope.lastName &#x3D; &quot;Doe&quot;;    &#x2F;&#x2F;控制器属性</span><br><span class="line">    $scope.fullName &#x3D; function() &#123;  &#x2F;&#x2F;控制器方法</span><br><span class="line">        return $scope.firstName + &quot; &quot; + $scope.lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt; </span><br></pre></td></tr></table></figure>
<h4 id="AngularJS-过滤器"><a href="#AngularJS-过滤器" class="headerlink" title="AngularJS 过滤器"></a>AngularJS 过滤器</h4></li>
<li><p>过滤器可以使用一个管道字符（|）添加到表达式和指令中<br>常用的过滤器</p>
<ul>
<li>currency     格式化数字为货币格式。</li>
<li>filter     从数组项中选择一个子集。</li>
<li>lowercase     格式化字符串为小写。</li>
<li>orderBy     根据某个表达式排列数组。</li>
<li>uppercase     格式化字符串为大写。</li>
</ul>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1、uppercase，lowercase 大小写转换</span><br><span class="line"></span><br><span class="line">&#123;&#123; &quot;lower cap string&quot; | uppercase &#125;&#125;   &#x2F;&#x2F; 结果：LOWER CAP STRING</span><br><span class="line">&#123;&#123; &quot;TANK is GOOD&quot; | lowercase &#125;&#125;      &#x2F;&#x2F; 结果：tank is good</span><br><span class="line"></span><br><span class="line">2、date 格式化</span><br><span class="line"></span><br><span class="line">&#123;&#123;1490161945000 | date:&quot;yyyy-MM-dd HH:mm:ss&quot;&#125;&#125; &#x2F;&#x2F; 2017-03-22 13:52:25</span><br><span class="line"></span><br><span class="line">3、number 格式化（保留小数）</span><br><span class="line"></span><br><span class="line">&#123;&#123;149016.1945000 | number:2&#125;&#125;</span><br><span class="line"></span><br><span class="line">4、currency货币格式化</span><br><span class="line"></span><br><span class="line">&#123;&#123; 250 | currency &#125;&#125;            &#x2F;&#x2F; 结果：$250.00</span><br><span class="line">&#123;&#123; 250 | currency:&quot;RMB ￥ &quot; &#125;&#125;  &#x2F;&#x2F; 结果：RMB ￥ 250.00</span><br><span class="line"></span><br><span class="line">5、filter查找</span><br><span class="line"></span><br><span class="line">输入过滤器可以通过一个管道字符（|）和一个过滤器添加到指令中，该过滤器后跟一个冒号和一个模型名称。</span><br><span class="line"></span><br><span class="line">filter 过滤器从数组中选择一个子集</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F; 查找name为iphone的行</span><br><span class="line">&lt;!-- </span><br><span class="line">       </span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">6、limitTo 截取</span><br><span class="line"></span><br><span class="line">&#123;&#123;&quot;1234567890&quot; | limitTo :6&#125;&#125; &#x2F;&#x2F; 从前面开始截取6位</span><br><span class="line">&#123;&#123;&quot;1234567890&quot; | limitTo:-4&#125;&#125; &#x2F;&#x2F; 从后面开始截取4位</span><br><span class="line"></span><br><span class="line">7、orderBy 排序</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F; 根id降序排</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 根据id升序排</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 表达式中添加过滤器 --&gt;</span><br><span class="line"> &lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;personCtrl&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;p&gt;姓名为 &#123;&#123; lastName | uppercase &#125;&#125;&lt;&#x2F;p&gt;&lt;!--  uppercase 过滤器将字符串格式化为大写 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt; </span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;costCtrl&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;input type&#x3D;&quot;number&quot; ng-model&#x3D;&quot;quantity&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;number&quot; ng-model&#x3D;&quot;price&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;总价 &#x3D; &#123;&#123; (quantity * price) | currency &#125;&#125;&lt;&#x2F;p&gt;&lt;!-- currency 过滤器将数字格式化为货币格式 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt; </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;namesCtrl&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li ng-repeat&#x3D;&quot;x in names | orderBy:&#39;country&#39;&quot;&gt; &lt;!-- 向指令添加过滤器。过滤器可以通过一个管道字符（|）和一个过滤器添加到指令中。orderBy 过滤器根据表达式排列数组 --&gt;</span><br><span class="line">    &#123;&#123; x.name + &#39;, &#39; + x.country &#125;&#125;</span><br><span class="line">  &lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt; </span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 自定义过滤器:以下实例自定义一个过滤器 reverse，将字符串反转 --&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;myCtrl&#39;, function($scope) &#123;</span><br><span class="line">    $scope.msg &#x3D; &quot;Runoob&quot;;</span><br><span class="line">&#125;);</span><br><span class="line">app.filter(&#39;reverse&#39;, function() &#123; &#x2F;&#x2F;可以注入依赖</span><br><span class="line">    return function(text) &#123;</span><br><span class="line">        return text.split(&quot;&quot;).reverse().join(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></code></pre>
<h3 id="AngularJS基础（二）"><a href="#AngularJS基础（二）" class="headerlink" title="AngularJS基础（二）"></a>AngularJS基础（二）</h3><h4 id="AngularJS-服务-Service"><a href="#AngularJS-服务-Service" class="headerlink" title="AngularJS 服务(Service)"></a>AngularJS 服务(Service)</h4><ul>
<li><p>在 AngularJS 中，服务是一个函数或对象，可在你的 AngularJS 应用中使用。<br>AngularJS 内建了30 多个服务，且你可以自己建立服务。</p>
</li>
<li><p>$location 服务，它可以返回当前页面的 URL 地址</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  与window.location 对象相似，但在AngularJS中$location更好用 --&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;customersCtrl&#39;, function($scope, $location) &#123;</span><br><span class="line">    $scope.myUrl &#x3D; $location.absUrl();</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure></li>
<li><p>$http 服务<br>$http 是 AngularJS 应用中最常用的服务。 服务向服务器发送请求，应用响应服务器传送过来的数据。<br>$http 是 AngularJS 中的一个核心服务，用于读取远程服务器的数据。</p>
</li>
<li><p>使用格式：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;标准格式</span><br><span class="line">&#x2F;&#x2F; 简单的 GET 请求，可以改为 POST</span><br><span class="line">$http(&#123;</span><br><span class="line">    method: &#39;GET&#39;,</span><br><span class="line">    url: &#39;&#x2F;someUrl&#39;</span><br><span class="line">&#125;).then(function successCallback(response) &#123;</span><br><span class="line">        &#x2F;&#x2F; 请求成功执行代码</span><br><span class="line">    &#125;, function errorCallback(response) &#123;</span><br><span class="line">        &#x2F;&#x2F; 请求失败执行代码</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;例：</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;myCtrl&#39;, function($scope, $http) &#123;</span><br><span class="line">    $http.get(&quot;welcome.htm&quot;).then(function (response) &#123;</span><br><span class="line">        $scope.myWelcome &#x3D; response.data;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>$timeout 服务<br>AngularJS $timeout 服务对应了 JS window.setTimeout 函数。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;myCtrl&#39;, function($scope, $timeout) &#123;</span><br><span class="line">    $scope.myHeader &#x3D; &quot;Hello World!&quot;;</span><br><span class="line">    $timeout(function () &#123;</span><br><span class="line">        $scope.myHeader &#x3D; &quot;How are you today?&quot;;</span><br><span class="line">    &#125;, 2000);&#x2F;&#x2F;两秒后显示&quot;How are you today?&quot;信息</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>$interval 服务<br>AngularJS $interval 服务对应了 JS window.setInterval 函数。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;myCtrl&#39;, function($scope, $interval) &#123;</span><br><span class="line">    $scope.theTime &#x3D; new Date().toLocaleTimeString();</span><br><span class="line">    $interval(function () &#123;</span><br><span class="line">        $scope.theTime &#x3D; new Date().toLocaleTimeString();</span><br><span class="line">    &#125;, 1000);&#x2F;&#x2F;每隔一秒显示一次时间信息</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>创建自定义服务</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;创建名为hexafy 的服务</span><br><span class="line">app.service(&#39;hexafy&#39;, function() &#123;</span><br><span class="line">    this.myFunc &#x3D; function (x) &#123;</span><br><span class="line">        return x.toString(16);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">使用自定义的的服务 hexafy 将一个数字转换为16进制数:</span><br><span class="line">app.controller(&#39;myCtrl&#39;, function($scope, hexafy) &#123;&#x2F;&#x2F;注意自定义服务传入时，没有$符号</span><br><span class="line">    $scope.hex &#x3D; hexafy.myFunc(255);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>过滤器中，使用自定义服务</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.filter(&#39;myFormat&#39;,[&#39;hexafy&#39;, function(hexafy) &#123;</span><br><span class="line">    return function(x) &#123;</span><br><span class="line">        return hexafy.myFunc(x);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;]);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;使用我定义的过滤器</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;li ng-repeat&#x3D;&quot;x in counts&quot;&gt;&#123;&#123;x | myFormat&#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="AngularJS-Select-选择框"><a href="#AngularJS-Select-选择框" class="headerlink" title="AngularJS Select(选择框)"></a>AngularJS Select(选择框)</h4><ul>
<li><p>在 AngularJS 中我们可以使用 ng-option 指令来创建一个下拉列表，列表项通过对象和数组循环输出<br>  ng-repeat 指令是通过数组来循环 HTML 代码来创建下拉列表，但 ng-options 指令更适合创建下拉列表，它有以下优势：<br>使用 ng-options 的选项是一个对象， ng-repeat 是一个字符串。当选择值是一个对象时，我们就可以获取更多信息，应用也更灵活。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;</span><br><span class="line"> </span><br><span class="line">&lt;select ng-init&#x3D;&quot;selectedName &#x3D; names[0]&quot; ng-model&#x3D;&quot;selectedName&quot; ng-options&#x3D;&quot;x for x in names&quot;&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;myCtrl&#39;, function($scope) &#123;</span><br><span class="line">    $scope.names &#x3D; [&quot;Google&quot;, &quot;Runoob&quot;, &quot;Taobao&quot;];</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;将数据对象作为数据源</span><br><span class="line">$scope.sites &#x3D; &#123;</span><br><span class="line">    site01 : &quot;Google&quot;,</span><br><span class="line">    site02 : &quot;Runoob&quot;,</span><br><span class="line">    site03 : &quot;Taobao&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;使用对象作为数据源, x 为键(key), y 为值(value):</span><br><span class="line">&lt;select ng-model&#x3D;&quot;selectedSite&quot; ng-options&#x3D;&quot;x for (x, y) in sites&quot;&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;你选择的值是: &#123;&#123;selectedSite&#125;&#125;&lt;&#x2F;h1&gt;</span><br></pre></td></tr></table></figure>
<h4 id="AngularJS-HTML-DOM"><a href="#AngularJS-HTML-DOM" class="headerlink" title="AngularJS HTML DOM"></a>AngularJS HTML DOM</h4></li>
<li><p>ng-disabled 指令<br>ng-disabled 指令直接绑定应用程序数据到 HTML 的 disabled 属性。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app&#x3D;&quot;&quot; ng-init&#x3D;&quot;mySwitch&#x3D;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;</span><br><span class="line">&lt;button ng-disabled&#x3D;&quot;mySwitch&quot;&gt;点我!&lt;&#x2F;button&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;checkbox&quot; ng-model&#x3D;&quot;mySwitch&quot;&gt;按钮 &lt;!-- mySwitch的值为true时，button将不可操作 --&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;</span><br><span class="line">&#123;&#123; mySwitch &#125;&#125;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt; </span><br></pre></td></tr></table></figure></li>
<li><p>ng-show 指令<br>ng-show 指令隐藏或显示一个 HTML 元素。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app&#x3D;&quot;&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;p ng-show&#x3D;&quot;true&quot;&gt;我是可见的。&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p ng-show&#x3D;&quot;false&quot;&gt;我是不可见的。&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt; </span><br></pre></td></tr></table></figure></li>
<li><p>ng-hide 指令<br>ng-hide 指令用于隐藏或显示 HTML 元素。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div ng-app&#x3D;&quot;&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;p ng-hide&#x3D;&quot;true&quot;&gt;我是不可见的。&lt;&#x2F;p&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;p ng-hide&#x3D;&quot;false&quot;&gt;我是可见的。&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt; </span><br></pre></td></tr></table></figure>
<h4 id="AngularJS-事件"><a href="#AngularJS-事件" class="headerlink" title="AngularJS 事件"></a>AngularJS 事件</h4></li>
<li><p>ng-click 指令定义了 AngularJS 点击事件</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app&#x3D;&quot;&quot; ng-controller&#x3D;&quot;myCtrl&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;button ng-click&#x3D;&quot;count &#x3D; count + 1&quot;&gt;点我！&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&#123;&#123; count &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 控制显示 HTML 元素 --&gt;</span><br><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;personCtrl&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;button ng-click&#x3D;&quot;toggle()&quot;&gt;隐藏&#x2F;显示&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;p ng-show&#x3D;&quot;myVar&quot;&gt;</span><br><span class="line">名: &lt;input type&#x3D;&quot;text&quot; ng-model&#x3D;&quot;firstName&quot;&gt;&lt;br&gt;</span><br><span class="line">姓: &lt;input type&#x3D;&quot;text&quot; ng-model&#x3D;&quot;lastName&quot;&gt;&lt;br&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">姓名: &#123;&#123;firstName + &quot; &quot; + lastName&#125;&#125;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;personCtrl&#39;, function($scope) &#123;</span><br><span class="line">    $scope.firstName &#x3D; &quot;John&quot;,</span><br><span class="line">    $scope.lastName &#x3D; &quot;Doe&quot;</span><br><span class="line">    $scope.myVar &#x3D; true;</span><br><span class="line">    $scope.toggle &#x3D; function() &#123;</span><br><span class="line">        $scope.myVar &#x3D; !$scope.myVar;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt; </span><br></pre></td></tr></table></figure>
<h4 id="AngularJS-API"><a href="#AngularJS-API" class="headerlink" title="AngularJS API"></a>AngularJS API</h4><ul>
<li><p>AngularJS 全局 API 用于执行常见任务的 JavaScript 函数集合，如：</p>
<ul>
<li>比较对象</li>
<li>迭代对象</li>
<li>转换对象<br>全局 API 函数使用 angular 对象进行访问。</li>
<li>angular.lowercase()     转换字符串为小写</li>
<li>angular.uppercase()     转换字符串为大写</li>
<li>angular.isString()     判断给定的对象是否为字符串，如果是返回 true。</li>
<li>angular.isNumber()     判断给定的对象是否为数字，如果是返回 true。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="AngularJS-包含"><a href="#AngularJS-包含" class="headerlink" title="AngularJS 包含"></a>AngularJS 包含</h4><ul>
<li><p>使用 AngularJS, 你可以使用 ng-include 指令来包含 HTML 内容:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;body ng-app&#x3D;&quot;&quot;&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div ng-include&#x3D;&quot;&#39;runoob.htm&#39;&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>包含 AngularJS 代码</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">sites.htm文件中的内容：</span><br><span class="line"></span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tr ng-repeat&#x3D;&quot;x in names&quot;&gt;</span><br><span class="line">&lt;td&gt;&#123;&#123; x.Name &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&#123;&#123; x.Url &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;&#x2F;tr&gt;</span><br><span class="line">&lt;&#x2F;table&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div ng-app&#x3D;&quot;myApp&quot; ng-controller&#x3D;&quot;sitesCtrl&quot;&gt; </span><br><span class="line">  &lt;div ng-include&#x3D;&quot;&#39;sites.htm&#39;&quot;&gt;&lt;&#x2F;div&gt;&lt;!-- 引入sites.htm文件 --&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, []);</span><br><span class="line">app.controller(&#39;sitesCtrl&#39;, function($scope, $http) &#123;</span><br><span class="line">    $http.get(&quot;sites.php&quot;).then(function (response) &#123;</span><br><span class="line">        $scope.names &#x3D; response.data.records;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="AngularJS-动画"><a href="#AngularJS-动画" class="headerlink" title="AngularJS 动画"></a>AngularJS 动画</h4></li>
<li><p>AngularJS 提供了动画效果，可以配合 CSS 使用。ngAnimate 模型可以添加或移除 class 。ngAnimate 模型并不能使 HTML 元素产生动画，但是 ngAnimate 会监测事件，类似隐藏显示 HTML 元素 ，如果事件发生 ngAnimate 就会使用预定义的 class 来设置 HTML 元素的动画。<br>AngularJS 使用动画需要引入 angular-animate.min.js 库。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;..&#x2F;angular-animate.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body ng-app&#x3D;&quot;ngAnimate&quot;&gt;</span><br><span class="line"></span><br><span class="line">隐藏 DIV: &lt;input type&#x3D;&quot;checkbox&quot; ng-model&#x3D;&quot;myCheck&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;div ng-hide&#x3D;&quot;myCheck&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>
<p>如果我们应用已经设置了应用名，可以把 ngAnimate 直接添加在模型中：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;body ng-app&#x3D;&quot;myApp&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;隐藏 DIV: &lt;input type&#x3D;&quot;checkbox&quot; ng-model&#x3D;&quot;myCheck&quot;&gt;&lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;div ng-hide&#x3D;&quot;myCheck&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var app &#x3D; angular.module(&#39;myApp&#39;, [&#39;ngAnimate&#39;]);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="AngularJS-依赖注入"><a href="#AngularJS-依赖注入" class="headerlink" title="AngularJS 依赖注入"></a>AngularJS 依赖注入</h4></li>
<li><p>AngularJS 提供很好的依赖注入机制。以下5个核心组件用来作为依赖注入：</p>
<ul>
<li>value</li>
<li>factory</li>
<li>service</li>
<li>provider</li>
<li>constant</li>
</ul>
</li>
<li><p>value</p>
<p>  Value 是一个简单的 javascript 对象，用于向控制器传递值（配置阶段）： </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 定义一个模块</span><br><span class="line">var mainApp &#x3D; angular.module(&quot;mainApp&quot;, []);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 创建 value 对象 &quot;defaultInput&quot; 并传递数据</span><br><span class="line">mainApp.value(&quot;defaultInput&quot;, 5);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 将 &quot;defaultInput&quot; 注入到控制器</span><br><span class="line">mainApp.controller(&#39;CalcController&#39;, function($scope, CalcService, defaultInput) &#123;</span><br><span class="line">   $scope.number &#x3D; defaultInput;</span><br><span class="line">   $scope.result &#x3D; CalcService.square($scope.number);</span><br><span class="line">   </span><br><span class="line">   $scope.square &#x3D; function() &#123;</span><br><span class="line">      $scope.result &#x3D; CalcService.square($scope.number);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>剩下的理解更深入一步再写。</p>
</li>
</ul>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/Java/2018-01-01-Dubbo 注解驱动/">Dubbo 注解驱动（Annotation-Driven）</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <h1 id="Dubbo-注解驱动（Annotation-Driven）"><a href="#Dubbo-注解驱动（Annotation-Driven）" class="headerlink" title="Dubbo 注解驱动（Annotation-Driven）"></a>Dubbo 注解驱动（Annotation-Driven）</h1><h2 id="主目录"><a href="#主目录" class="headerlink" title="主目录"></a><a href="Dubbo-New-Programming-Model.md">主目录</a></h2><h2 id="注解驱动（Annotation-Driven）"><a href="#注解驱动（Annotation-Driven）" class="headerlink" title="注解驱动（Annotation-Driven）"></a>注解驱动（Annotation-Driven）</h2><h3 id="DubboComponentScan"><a href="#DubboComponentScan" class="headerlink" title="@DubboComponentScan"></a><code>@DubboComponentScan</code></h3><h4 id="起始版本：-2-5-7"><a href="#起始版本：-2-5-7" class="headerlink" title="起始版本： 2.5.7"></a>起始版本： <code>2.5.7</code></h4><h4 id="lt-dubbo-annotation-gt-历史遗留问题"><a href="#lt-dubbo-annotation-gt-历史遗留问题" class="headerlink" title="&lt;dubbo:annotation&gt; 历史遗留问题"></a><code>&lt;dubbo:annotation&gt; </code>历史遗留问题</h4><h5 id="1-注解支持不充分"><a href="#1-注解支持不充分" class="headerlink" title="1. 注解支持不充分"></a>1. 注解支持不充分</h5><p>在 Dubbo  <code>2.5.7</code>之前的版本 ，Dubbo 提供了两个核心注解 <code>@Service</code> 以及 <code>@Reference</code>，分别用于Dubbo 服务提供和 Dubbo 服务引用。</p>
<p>其中，<code>@Service</code> 作为 XML 元素 <code>&lt;dubbo:service&gt;</code>的替代注解，与 Spring Framework <code>@org.springframework.stereotype.Service</code> 类似，用于服务提供方 Dubbo 服务暴露。与之相对应的<code>@Reference</code>，则是替代<code>&lt;dubbo:reference</code> 元素，类似于 Spring 中的 <code>@Autowired</code>。</p>
<p> <code>2.5.7</code> 之前的Dubbo，与早期的 Spring Framework 2.5 存在类似的不足，即注解支持不够充分。注解需要和 XML 配置文件配合使用，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;annotation-provider&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;127.0.0.1:4548&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;com.alibaba.dubbo.config.spring.annotation.provider&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h5 id="2-Service-Bean-不支持-Spring-AOP"><a href="#2-Service-Bean-不支持-Spring-AOP" class="headerlink" title="2.  @Service Bean 不支持 Spring AOP"></a>2.  <code>@Service</code> Bean 不支持 Spring AOP</h5><p>同时，使用 <code>&lt;dubbo:annotation&gt; </code> 方式扫描后的Dubbo <code>@Service</code> ，在 Spring 代理方面存在问题，如 GitHub 上的 issue <a target="_blank" rel="noopener" href="https://github.com/alibaba/dubbo/issues/794%EF%BC%9A">https://github.com/alibaba/dubbo/issues/794：</a></p>
<blockquote>
<p>关于dubbo @Service注解生成ServiceBean时, interface获取成spring 的代理对象的bug</p>
<blockquote>
<p>在项目里， 我使用了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="meta">@Service</span></span><br><span class="line">&gt;<span class="meta">@Transactional</span></span><br><span class="line">&gt;<span class="meta">@com</span>.alibaba.dubbo.config.annotation.Service</span><br><span class="line">&gt;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SUserJpushServiceImp</span></span></span><br></pre></td></tr></table></figure>

<p>的形式， 来暴露服务。但是在发布服务的时候， interface class 是通过<br><code>serviceConfig.setInterface(bean.getClass().getInterfaces()[0]);</code><br>的形式获取， 刚好， 我的service都使用了@Transactional注解， 对象被代理了。所以获取到的interface是Spring的代理接口…</p>
</blockquote>
</blockquote>
<p>不少热心的小伙伴不仅发现这个历史遗留问题，而且提出了一些修复方案。同时，为了更好地适配 Spring 生命周期以及将 Dubbo 完全向注解驱动编程模型过渡，因此，引入了全新 Dubbo 组件扫描注解 - <code>@DubboComponentScan</code>。</p>
<blockquote>
<p>注： <code>&lt;dubbo:annotation&gt; </code>  Spring AOP 问题将在 <code>2.5.9</code> 中修复：<a target="_blank" rel="noopener" href="https://github.com/alibaba/dubbo/issues/1125">https://github.com/alibaba/dubbo/issues/1125</a></p>
</blockquote>
<h5 id="3-Reference-不支持字段继承性"><a href="#3-Reference-不支持字段继承性" class="headerlink" title="3. @Reference 不支持字段继承性"></a>3. @Reference 不支持字段继承性</h5><p>假设有一个 Spring Bean <code>AnnotationAction</code> 直接通过字段<code>annotationService</code> 标记 <code>@Reference</code> 引用 <code>AnnotationService</code> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.examples.annotation.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.examples.annotation.api.AnnotationService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;annotationAction&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> AnnotationService annotationService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doSayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> annotationService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>当<code>AnnotationAction</code>  被 XML 元素 <code>&lt;dubbo:annotation&gt;</code> 扫描后：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;com.alibaba.dubbo.examples.annotation.action&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<p>字段 <code>annotationService</code> 能够引用到 <code>AnnotationService</code>，执行 <code>doSayHello</code> 方法能够正常返回。</p>
<p>如果将字段<code>annotationService</code>  抽取到<code>AnnotationAction</code> 的父类<code>BaseAction</code> 后，<code>AnnotationService</code> 无法再被引用，改造如下所示：</p>
<p><code>AnnotationAction.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;annotationAction&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationAction</span> <span class="keyword">extends</span> <span class="title">BaseAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doSayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getAnnotationService().sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>BaseAction.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> AnnotationService annotationService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AnnotationService <span class="title">getAnnotationService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> annotationService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>改造后，再次执行 <code>doSayHello</code> 方法，<code>NullPointerException</code> 将会被抛出。说明<code>&lt;dubbo:annotation&gt;</code> 并不支持<code>@Reference</code> 字段继承性。</p>
<p>了解了历史问题，集合整体愿景，下面介绍<code>@DubboComponentScan</code> 的设计原则。</p>
<h4 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h4><p>Spring Framework 3.1 引入了新 Annotation - <code>@ComponentScan</code> ， 完全替代了 XML 元素 <code> &lt;context:component-scan&gt;</code> 。同样， <code>@DubboComponentScan</code>  作为 Dubbo <code>2.5.7</code> 新增的 Annotation，也是XML 元素  <code>&lt;dubbo:annotation&gt;</code> 的替代方案。</p>
<p>在命名上（类名以及属性方法），为了简化使用和关联记忆，Dubbo 组件扫描 Annotation <code>@DubboComponentScan</code>，借鉴了 Spring Boot 1.3 引入的 <code>@ServletComponentScan</code>。定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DubboComponentScan &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Alias for the &#123;<span class="doctag">@link</span> #basePackages()&#125; attribute. Allows for more concise annotation</span></span><br><span class="line"><span class="comment">     * declarations e.g.: &#123;<span class="doctag">@code</span> <span class="doctag">@DubboComponentScan</span>(&quot;org.my.pkg&quot;)&#125; instead of</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> <span class="doctag">@DubboComponentScan</span>(basePackages=&quot;org.my.pkg&quot;)&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the base packages to scan</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Base packages to scan for annotated <span class="doctag">@Service</span> classes. &#123;<span class="doctag">@link</span> #value()&#125; is an</span></span><br><span class="line"><span class="comment">     * alias for (and mutually exclusive with) this attribute.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Use &#123;<span class="doctag">@link</span> #basePackageClasses()&#125; for a type-safe alternative to String-based</span></span><br><span class="line"><span class="comment">     * package names.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the base packages to scan</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Type-safe alternative to &#123;<span class="doctag">@link</span> #basePackages()&#125; for specifying the packages to</span></span><br><span class="line"><span class="comment">     * scan for annotated <span class="doctag">@Service</span> classes. The package of each class specified will be</span></span><br><span class="line"><span class="comment">     * scanned.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> classes from the base packages to scan</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Class&lt;?&gt;[] basePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>注意：<code>basePackages()</code> 和 <code>value()</code> 均能支持占位符（placeholder）指定的包名</p>
</blockquote>
<p>在职责上，<code>@DubboComponentScan</code> 相对于 Spring Boot <code>@ServletComponentScan</code> 更为繁重，原因在于处理 Dubbo  <code>@Service</code> 类暴露 Dubbo 服务外，还有帮助 Spring  Bean <code>@Reference</code>字段或者方法注入 Dubbo 服务代理。 </p>
<p> 在场景上，Spring Framework <code>@ComponentScan</code> 组件扫描逻辑更为复杂。而在 <code>@DubboComponentScan</code>  只需关注 <code>@Service</code> 和 <code>@Reference</code> 处理。</p>
<p>在功能上， <code>@DubboComponentScan</code>  不但需要提供完整 Spring AOP 支持的能力，而且还得具备<code>@Reference </code> 字段可继承性的能力。</p>
<p>了解基本设计原则后，下面通过完整的示例，简介<code>@DubboComponentScan</code> 使用方法以及注意事项。</p>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><p>后续通过服务提供方（<code>@Serivce</code>）以及服务消费方（<code>@Reference</code>）两部分来介绍<code>@DubboComponentScan</code> 使用方法。</p>
<p>假设，服务提供方和服务消费分均依赖服务接口<code>DemoService</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">sayHello</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="服务提供方（-Serivce）"><a href="#服务提供方（-Serivce）" class="headerlink" title="服务提供方（@Serivce）"></a>服务提供方（<code>@Serivce</code>）</h5><h6 id="实现-DemoService"><a href="#实现-DemoService" class="headerlink" title="实现 DemoService"></a>实现 <code>DemoService</code></h6><p>服务提供方实现<code>DemoService</code>  - <code>AnnotationDemoService</code> ，同时标注 Dubbo <code>@Service</code> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.DemoService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotation &#123;<span class="doctag">@link</span> DemoService&#125; 实现</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationDemoService</span> <span class="keyword">implements</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello , &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h6 id="服务提供方-Annotation-配置"><a href="#服务提供方-Annotation-配置" class="headerlink" title="服务提供方 Annotation 配置"></a>服务提供方 Annotation 配置</h6><p>将 <code>AnnotationDemoService</code> 暴露成Dubbo 服务，需要依赖 Spring Bean：<code>AplicationConfig</code>、<code>ProtocolConfig</code> 以及 <code>RegistryConfig</code>  。这三个 Spring Bean 过去可通过 XML 文件方式组装 Spring Bean：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    &quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 当前应用信息配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;dubbo-annotation-provider&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 连接注册中心配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">&quot;my-registry&quot;</span> <span class="attr">address</span>=<span class="string">&quot;N/A&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;12345&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>以上装配方式不予推荐，推荐使用 Annotation 配置，因此可以换成 Spring <code>@Configuration</code> Bean 的形式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ProtocolConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.RegistryConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.spring.context.annotation.DubboComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务提供方配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@DubboComponentScan(&quot;com.alibaba.dubbo.demo.provider&quot;)</span> <span class="comment">// 扫描 Dubbo 组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前应用配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;dubbo-annotation-provider&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationConfig <span class="title">applicationConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationConfig applicationConfig = <span class="keyword">new</span> ApplicationConfig();</span><br><span class="line">        applicationConfig.setName(<span class="string">&quot;dubbo-annotation-provider&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> applicationConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前连接注册中心配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;my-registry&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RegistryConfig <span class="title">registryConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RegistryConfig registryConfig = <span class="keyword">new</span> RegistryConfig();</span><br><span class="line">        registryConfig.setAddress(<span class="string">&quot;N/A&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registryConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前连接注册中心配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;dubbo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProtocolConfig <span class="title">protocolConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ProtocolConfig protocolConfig = <span class="keyword">new</span> ProtocolConfig();</span><br><span class="line">        protocolConfig.setName(<span class="string">&quot;dubbo&quot;</span>);</span><br><span class="line">        protocolConfig.setPort(<span class="number">12345</span>);</span><br><span class="line">        <span class="keyword">return</span> protocolConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h6 id="服务提供方引导类"><a href="#服务提供方引导类" class="headerlink" title="服务提供方引导类"></a>服务提供方引导类</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo.bootstrap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.DemoService;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.config.ProviderConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务提供方引导类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建 Annotation 配置上下文</span></span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">        <span class="comment">// 注册配置 Bean</span></span><br><span class="line">        context.register(ProviderConfiguration.class);</span><br><span class="line">        <span class="comment">// 启动上下文</span></span><br><span class="line">        context.refresh();</span><br><span class="line">        <span class="comment">// 获取 DemoService Bean</span></span><br><span class="line">        DemoService demoService = context.getBean(DemoService.class);</span><br><span class="line">        <span class="comment">// 执行 sayHello 方法</span></span><br><span class="line">        String message = demoService.sayHello(<span class="string">&quot;World&quot;</span>);</span><br><span class="line">        <span class="comment">// 控制台输出信息</span></span><br><span class="line">        System.out.println(message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>ProviderBootstrap</code> 启动并执行后，控制输出与预期一致：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello , World</span><br></pre></td></tr></table></figure>



<p>以上直接结果说明 <code>@DubboComponentScan(&quot;com.alibaba.dubbo.demo.provider&quot;)</code> 扫描后，标注 Dubbo <code>@Service</code> 的 <code>AnnotationDemoService</code> 被注册成 Spring Bean，可从 Spring ApplicationContext 自由获取。</p>
<h5 id="服务消费方（-Reference）"><a href="#服务消费方（-Reference）" class="headerlink" title="服务消费方（@Reference）"></a>服务消费方（<code>@Reference</code>）</h5><h6 id="服务-DemoService"><a href="#服务-DemoService" class="headerlink" title="服务 DemoService"></a>服务 <code>DemoService</code></h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.DemoService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotation 驱动 &#123;<span class="doctag">@link</span> DemoService&#125; 消费方</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationDemoServiceConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference(url = &quot;dubbo://127.0.0.1:12345&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doSayHell</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> demoService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h6 id="服务消费方-Annotation-配置"><a href="#服务消费方-Annotation-配置" class="headerlink" title="服务消费方 Annotation 配置"></a>服务消费方 Annotation 配置</h6><p>与服务提供方配置类似，服务消费方也许 Dubbo 相关配置 Bean - <code>ConsumerConfiguration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.RegistryConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.spring.context.annotation.DubboComponentScan;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.consumer.AnnotationDemoServiceConsumer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务消费方配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@DubboComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前应用配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationConfig <span class="title">applicationConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationConfig applicationConfig = <span class="keyword">new</span> ApplicationConfig();</span><br><span class="line">        applicationConfig.setName(<span class="string">&quot;dubbo-annotation-consumer&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> applicationConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前连接注册中心配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RegistryConfig <span class="title">registryConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RegistryConfig registryConfig = <span class="keyword">new</span> RegistryConfig();</span><br><span class="line">        registryConfig.setAddress(<span class="string">&quot;N/A&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registryConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册 AnnotationDemoServiceConsumer，<span class="doctag">@DubboComponentScan</span> 将处理其中 <span class="doctag">@Reference</span> 字段。</span></span><br><span class="line"><span class="comment">     * 如果 AnnotationDemoServiceConsumer 非 Spring Bean 的话，</span></span><br><span class="line"><span class="comment">     * 即使 <span class="doctag">@DubboComponentScan</span> 指定 package 也不会进行处理，与 Spring <span class="doctag">@Autowired</span> 同理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AnnotationDemoServiceConsumer <span class="title">annotationDemoServiceConsumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AnnotationDemoServiceConsumer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="服务消费方引导类"><a href="#服务消费方引导类" class="headerlink" title="服务消费方引导类"></a>服务消费方引导类</h6><p>服务消费方需要先引导服务提供方，下面的实例将会启动两个 Spring 应用上下文，首先引导服务提供方 Spring 应用上下文，同时，需要复用前面Annotation 配置 <code>ProviderConfiguration</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动服务提供方上下文</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startProviderContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 Annotation 配置上下文</span></span><br><span class="line">    AnnotationConfigApplicationContext providerContext = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">    <span class="comment">// 注册配置 Bean</span></span><br><span class="line">    providerContext.register(ProviderConfiguration.class);</span><br><span class="line">    <span class="comment">// 启动服务提供方上下文</span></span><br><span class="line">    providerContext.refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>然后引导服务消费方Spring 应用上下文：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动并且返回服务消费方上下文</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> AnnotationConfigApplicationContext</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext <span class="title">startConsumerContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建服务消费方 Annotation 配置上下文</span></span><br><span class="line">    AnnotationConfigApplicationContext consumerContext = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">    <span class="comment">// 注册服务消费方配置 Bean</span></span><br><span class="line">    consumerContext.register(ConsumerConfiguration.class);</span><br><span class="line">    <span class="comment">// 启动服务消费方上下文</span></span><br><span class="line">    consumerContext.refresh();</span><br><span class="line">    <span class="comment">// 返回服务消费方 Annotation 配置上下文</span></span><br><span class="line">    <span class="keyword">return</span> consumerContext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>完整的引导类实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo.bootstrap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.config.ConsumerConfiguration;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.config.ProviderConfiguration;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.consumer.AnnotationDemoServiceConsumer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务消费端引导类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 启动服务提供方上下文</span></span><br><span class="line">        startProviderContext();</span><br><span class="line">        <span class="comment">// 启动并且返回服务消费方上下文</span></span><br><span class="line">        ApplicationContext consumerContext = startConsumerContext();</span><br><span class="line">        <span class="comment">// 获取 AnnotationDemoServiceConsumer Bean</span></span><br><span class="line">        AnnotationDemoServiceConsumer consumer = consumerContext.getBean(AnnotationDemoServiceConsumer.class);</span><br><span class="line">        <span class="comment">// 执行 doSayHello 方法</span></span><br><span class="line">        String message = consumer.doSayHello(<span class="string">&quot;World&quot;</span>);</span><br><span class="line">        <span class="comment">// 输出执行结果</span></span><br><span class="line">        System.out.println(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动并且返回服务消费方上下文</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> AnnotationConfigApplicationContext</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext <span class="title">startConsumerContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建服务消费方 Annotation 配置上下文</span></span><br><span class="line">        AnnotationConfigApplicationContext consumerContext = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">        <span class="comment">// 注册服务消费方配置 Bean</span></span><br><span class="line">        consumerContext.register(ConsumerConfiguration.class);</span><br><span class="line">        <span class="comment">// 启动服务消费方上下文</span></span><br><span class="line">        consumerContext.refresh();</span><br><span class="line">        <span class="comment">// 返回服务消费方 Annotation 配置上下文</span></span><br><span class="line">        <span class="keyword">return</span> consumerContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动服务提供方上下文</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startProviderContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建 Annotation 配置上下文</span></span><br><span class="line">        AnnotationConfigApplicationContext providerContext = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">        <span class="comment">// 注册配置 Bean</span></span><br><span class="line">        providerContext.register(ProviderConfiguration.class);</span><br><span class="line">        <span class="comment">// 启动服务提供方上下文</span></span><br><span class="line">        providerContext.refresh();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行<code>ConsumerBootstrap</code>结果，仍然符合期望，<code>AnnotationDemoServiceConsumer</code> 输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello , World</span><br></pre></td></tr></table></figure>







<h4 id="Spring-AOP-支持"><a href="#Spring-AOP-支持" class="headerlink" title="Spring AOP 支持"></a>Spring AOP 支持</h4><p>前面提到 <code>&lt;dubbo:annotation&gt; </code>  注册 Dubbo <code>@Service</code> 组件后，在 Spring AOP 支持方面存在问题。事务作为 Spring AOP 的功能扩展，自然也会在 <code>&lt;dubbo:annotation&gt; </code>中不支持。</p>
<p><code>@DubboComponentScan</code> 针对以上问题，实现了对 Spring AOP 是完全兼容。将上述服务提供方 Annotation 配置做出一定的调整，标注<code>@EnableTransactionManagement</code> 以及自定义实现<code>PlatformTransactionManager</code> :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@DubboComponentScan(&quot;com.alibaba.dubbo.demo.provider&quot;)</span> <span class="comment">// 扫描 Dubbo 组件</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">// 激活事务管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderConfiguration</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 省略其他配置 Bean 定义</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义事务管理器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PlatformTransactionManager() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> TransactionStatus <span class="title">getTransaction</span><span class="params">(TransactionDefinition definition)</span> <span class="keyword">throws</span> TransactionException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;get transaction ...&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> SimpleTransactionStatus();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;commit transaction ...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;rollback transaction ...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>同时调整 <code>AnnotationDemoService</code>  - 增加<code>@Transactional</code> 注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationDemoService</span> <span class="keyword">implements</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 省略实现，保持不变</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>再次运行<code>ConsumerBootstrap</code> , 观察控制台输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get transaction ...</span><br><span class="line">commit transaction ...</span><br><span class="line">Hello , World</span><br></pre></td></tr></table></figure>



<p>输入内容中多处了两行，说明自定义 <code>PlatformTransactionManager</code> <code>getTransaction(TransactionDefinition)</code> 以及 <code>commit(TransactionStatus) </code> 方法被执行，进而说明 <code>AnnotationDemoService</code> 的<code>sayHello(String)</code> 方法执行时，事务也伴随执行。</p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p><code>ConsumerConfiguration</code> 上的  <code>@DubboComponentScan</code> 并没有指定 <code>basePackages</code> 扫描，这种情况会将<code>ConsumerConfiguration</code>  当做 <code>basePackageClasses</code> ，即扫描<code>ConsumerConfiguration</code> 所属的 package  <code>com.alibaba.dubbo.demo.config</code> 以及子 package。由于当前示例中，不存在标注 Dubbo <code>@Service</code>的类，因此在运行时日志（如果开启的话）会输出警告信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARN :  [DUBBO] No Spring Bean annotating Dubbo&#39;s @Service was found in Spring BeanFactory, dubbo version: 2.0.0, current host: 127.0.0.1</span><br></pre></td></tr></table></figure>



<p>以上信息大可不必担忧，因为 <code>@DubboComponentScan</code>  除了扫描 Dubbo <code>@Service</code> 组件以外，还将处理 <code>@Reference</code>字段注入。然而读者特别关注<code>@Reference</code>字段注入的规则。</p>
<p>以上实现为例，<code>AnnotationDemoServiceConsumer</code> 必须申明为 Spring  <code>@Bean</code> 或者 <code>@Component</code>（或者其派生注解），否则 <code>@DubboComponentScan</code> 不会主动将标注 <code>@Reference</code>字段所在的声明类提成为 Spring Bean，换句话说，如果 <code>@Reference</code>字段所在的声明类不是 Spring Bean 的话， <code>@DubboComponentScan</code> 不会处理<code>@Reference</code>注入，其原理与 Spring <code>@Autowired</code> 一致。</p>
<p>以上使用不当可能会导致相关问题，如 GitHub 上曾有小伙伴提问：<a target="_blank" rel="noopener" href="https://github.com/alibaba/dubbo/issues/825">https://github.com/alibaba/dubbo/issues/825</a></p>
<blockquote>
<p><strong>li362692680</strong> 提问：</p>
<blockquote>
<p>@DubboComponentScan注解在消费端扫描包时扫描的是 @Service注解？？不是@Reference注解？？<br>启动时报<br>DubboComponentScanRegistrar-85]-[main]-[INFO] 0 annotated @Service Components { [] }</p>
</blockquote>
<p>笔者(<strong>mercyblitz</strong>)回复：</p>
<blockquote>
<p><code>@Reference</code> 类似于 <code>@Autowired</code> 一样，首先其申明的类必须被 Spring 上下文当做一个Bean，因此，Dubbo 并没有直接将 <code>@Reference</code>  字段所在的类提升成 Bean。</p>
<p>综上所述，这并不是一个问题，而是用法不当！</p>
</blockquote>
</blockquote>
<h4 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h4><p>最新发布的 Dubbo <code>2.5.8</code> 中，<code>@DubboComponentScan</code>  在以下特殊场景下存在 Spring <code>@Service</code> 不兼容情况：</p>
<blockquote>
<p>假设有两个服务实现类 <code>A</code> 和 <code>B</code>，同时存放在<code>com.acme</code> 包下：</p>
<ul>
<li><code>A</code> 标注  Dubbo <code>@Service</code> </li>
<li><code>B</code> 标注  Dubbo <code>@Service</code> 和 Spring <code>@Service</code></li>
</ul>
<p>当 Spring <code>@ComponentScan</code> 先扫描<code>com.acme</code> 包时，<code>B</code> 被当做 Spring Bean 的候选类。随后，<code>@DubboComponentScan</code> 也扫描相同的包。当应用启动时，<code>A</code> 和 <code>B</code>  虽然都是  Spring Bean，可仅 <code>A</code> 能够暴露 Dubbo 服务，<code>B</code> 则丢失。</p>
</blockquote>
<p>问题版本：<code>2.5.7</code>、<code>2.5.8</code></p>
<p>问题详情：<a target="_blank" rel="noopener" href="https://github.com/alibaba/dubbo/issues/1120">https://github.com/alibaba/dubbo/issues/1120</a></p>
<p>修复版本：<code>2.5.9</code>（下个版本）</p>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>





  <article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/2018/04/08/Java/2018-01-18-Dubbo 外部化配置/">Dubbo 外部化配置（Externalized Configuration）</a></h1>
  

      
        <time datetime="2018-04-08T07:33:00.000Z">2018-04-08</time>
      
    </header>
    <div class="entry">
      
        <h1 id="Dubbo-外部化配置（Externalized-Configuration）"><a href="#Dubbo-外部化配置（Externalized-Configuration）" class="headerlink" title="Dubbo 外部化配置（Externalized Configuration）"></a>Dubbo 外部化配置（Externalized Configuration）</h1><h2 id="主目录"><a href="#主目录" class="headerlink" title="主目录"></a><a href="Dubbo-New-Programming-Model.md">主目录</a></h2><h2 id="外部化配置（External-Configuration）"><a href="#外部化配置（External-Configuration）" class="headerlink" title="外部化配置（External Configuration）"></a>外部化配置（External Configuration）</h2><p>在<a href="Dubbo-Annotation-Driven.md">Dubbo 注解驱动</a>例子中，无论是服务提供方，还是服务消费方，均需要转配相关配置Bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ApplicationConfig <span class="title">applicationConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationConfig applicationConfig = <span class="keyword">new</span> ApplicationConfig();</span><br><span class="line">    applicationConfig.setName(<span class="string">&quot;dubbo-annotation-consumer&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> applicationConfig;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>虽然实现类似于<code>ProviderConfiguration</code> 和 <code>ConsumerConfiguration</code> 这样的 Spring  <code>@Configuration</code> Bean 成本并不高，不过通过 Java Code 的方式定义配置 Bean，或多或少是一种 Hard Code（硬编码）的行为，缺少弹性。</p>
<p>尽管在 Spring 应用中，可以通过 <code>@Value</code> 或者 <code>Environment</code> 的方式获取外部配置，其代码简洁性以及类型转换灵活性存在明显的不足。因此，Spring Boot  提出了外部化配置（External Configuration）的感念，即通过程序以外的配置源，动态地绑定指定类型。</p>
<p>随着 Spring Boot / Spring Cloud 应用的流行，开发人员逐渐地接受并且使用 Spring Boot 外部化配置（External Configuration），即通过 <code>application.properties</code> 或者 <code>bootstrap.properties</code> 装配配置 Bean。</p>
<p>下列表格记录了 Dubbo 内置配置类：</p>
<table>
<thead>
<tr>
<th>配置类</th>
<th>标签</th>
<th>用途</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>ProtocolConfig</code></td>
<td><code>&lt;dubbo:protocol/&gt;</code></td>
<td>协议配置</td>
<td>用于配置提供服务的协议信息，协议由提供方指定，消费方被动接受</td>
</tr>
<tr>
<td><code>ApplicationConfig</code></td>
<td><code>&lt;dubbo:application/&gt;</code></td>
<td>应用配置</td>
<td>用于配置当前应用信息，不管该应用是提供者还是消费者</td>
</tr>
<tr>
<td><code>ModuleConfig</code></td>
<td><code>&lt;dubbo:module/&gt;</code></td>
<td>模块配置</td>
<td>用于配置当前模块信息，可选</td>
</tr>
<tr>
<td><code>RegistryConfig</code></td>
<td><code>&lt;dubbo:registry/&gt;</code></td>
<td>注册中心配置</td>
<td>用于配置连接注册中心相关信息</td>
</tr>
<tr>
<td><code>MonitorConfig</code></td>
<td><code>&lt;dubbo:monitor/&gt;</code></td>
<td>监控中心配置</td>
<td>用于配置连接监控中心相关信息，可选</td>
</tr>
<tr>
<td><code>ProviderConfig</code></td>
<td><code>&lt;dubbo:provider/&gt;</code></td>
<td>提供方配置</td>
<td>当 ProtocolConfig 和 ServiceConfig 某属性没有配置时，采用此缺省值，可选</td>
</tr>
<tr>
<td><code>ConsumerConfig</code></td>
<td><code>&lt;dubbo:consumer/&gt;</code></td>
<td>消费方配置</td>
<td>当 ReferenceConfig 某属性没有配置时，采用此缺省值，可选</td>
</tr>
<tr>
<td><code>MethodConfig</code></td>
<td><code>&lt;dubbo:method/&gt;</code></td>
<td>方法配置</td>
<td>用于 ServiceConfig 和 ReferenceConfig 指定方法级的配置信息</td>
</tr>
<tr>
<td><code>ArgumentConfig</code></td>
<td><code>&lt;dubbo:argument/&gt;</code></td>
<td>参数配置</td>
<td>用于指定方法参数配置</td>
</tr>
</tbody></table>
<p>通过申明对应的 Spring 扩展标签，在 Spring 应用上下文中将自动生成相应的配置 Bean。</p>
<p>在 Dubbo 官方用户手册的<a target="_blank" rel="noopener" href="http://dubbo.io/books/dubbo-user-book/configuration/properties.html">“属性配置”</a>章节中，<code>dubbo.properties</code> 配置属性能够映射到  <code>ApplicationConfig</code> 、<code>ProtocolConfig</code> 以及 <code>RegistryConfig</code> 的字段。从某种意义上来说，<code>dubbo.properties</code>  也是 Dubbo 的外部化配置。</p>
<p>其中，引用“映射规则”的内容：</p>
<blockquote>
<h2 id="映射规则"><a href="#映射规则" class="headerlink" title="映射规则"></a>映射规则</h2><p>将 XML 配置的标签名，加属性名，用点分隔，多个属性拆成多行</p>
<ul>
<li>比如：<code>dubbo.application.name=foo</code>等价于<code>&lt;dubbo:application name=&quot;foo&quot; /&gt;</code></li>
<li>比如：<code>dubbo.registry.address=10.20.153.10:9090</code>等价于<code>&lt;dubbo:registryaddress=&quot;10.20.153.10:9090&quot; /&gt;</code></li>
</ul>
<p>如果 XML 有多行同名标签配置，可用 id 号区分，如果没有 id 号将对所有同名标签生效</p>
<ul>
<li>比如：<code>dubbo.protocol.rmi.port=1234</code>等价于<code>&lt;dubbo:protocol id=&quot;rmi&quot; name=&quot;rmi&quot; port=&quot;1099&quot; /&gt;</code><a target="_blank" rel="noopener" href="http://dubbo.io/books/dubbo-user-book/configuration/properties.html#fn_2">2</a></li>
<li>比如：<code>dubbo.registry.china.address=10.20.153.10:9090</code>等价于<code>&lt;dubbo:registry id=&quot;china&quot;address=&quot;10.20.153.10:9090&quot; /&gt;</code></li>
</ul>
<p>下面是 dubbo.properties 的一个典型配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;dubbo.application.name&#x3D;foo</span><br><span class="line">&gt;dubbo.application.owner&#x3D;bar</span><br><span class="line">&gt;dubbo.registry.address&#x3D;10.20.153.10:9090</span><br></pre></td></tr></table></figure>
</blockquote>
<p>根据“映射规则”，Dubbo 即支持单配置 Bean 映射，也支持多 Bean 映射。综合以上需求，既要兼容 Dubbo 已有的一个或多个 Bean 字段映射绑定，也支持外部化配置。</p>
<blockquote>
<p>特别提醒：外部化配置（External Configuration）并非 Spring Boot 特有，即使在 Spring Framework 场景下亦能支持。也就是说 Dubbo 外部化配置即可在 Spring Framework 中工作，也能在 Spring Boot 中运行。</p>
</blockquote>
<p>Dubbo 外部化配置（External Configuration） 支持起始版本为：<code>2.5.8</code></p>
<h3 id="EnableDubboConfig"><a href="#EnableDubboConfig" class="headerlink" title="@EnableDubboConfig"></a><code>@EnableDubboConfig</code></h3><h4 id="起始版本：2-5-8"><a href="#起始版本：2-5-8" class="headerlink" title="起始版本：2.5.8"></a>起始版本：<code>2.5.8</code></h4><h4 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h4><h5 id="EnableDubboConfig-定义"><a href="#EnableDubboConfig-定义" class="headerlink" title="@EnableDubboConfig 定义"></a><code>@EnableDubboConfig</code> 定义</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableDubboConfig &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * It indicates whether binding to multiple Spring Beans.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the default value is &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@revised</span> 2.5.9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">multiple</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>multiple</code> : 表示是否支持多Dubbo 配置 Bean 绑定。默认值为 <code>false</code> ，即单 Dubbo 配置 Bean 绑定</li>
</ul>
<h5 id="单-Dubbo-配置-Bean-绑定"><a href="#单-Dubbo-配置-Bean-绑定" class="headerlink" title="单 Dubbo 配置 Bean 绑定"></a>单 Dubbo 配置 Bean 绑定</h5><p>为了更好地向下兼容，<code>@EnableDubboConfig</code> 提供外部化配置属性与 Dubbo 配置类之间的绑定，其中映射关系如下：</p>
<table>
<thead>
<tr>
<th>配置类</th>
<th>外部化配置属性前缀</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>ProtocolConfig</code></td>
<td><code>dubbo.protocol</code></td>
<td>协议配置</td>
</tr>
<tr>
<td><code>ApplicationConfig</code></td>
<td><code>dubbo.application</code></td>
<td>应用配置</td>
</tr>
<tr>
<td><code>ModuleConfig</code></td>
<td><code>dubbo.module</code></td>
<td>模块配置</td>
</tr>
<tr>
<td><code>RegistryConfig</code></td>
<td><code>dubbo.registry</code></td>
<td>注册中心配置</td>
</tr>
<tr>
<td><code>MonitorConfig</code></td>
<td><code>dubbo.monitor</code></td>
<td>监控中心配置</td>
</tr>
<tr>
<td><code>ProviderConfig</code></td>
<td><code>dubbo.provider</code></td>
<td>提供方配置</td>
</tr>
<tr>
<td><code>ConsumerConfig</code></td>
<td><code>dubbo.consumer</code></td>
<td>消费方配置</td>
</tr>
</tbody></table>
<p>当标注 <code>@EnableDubboConfig</code> 的类被扫描注册后，同时  Spring（Spring Boot）应用配置（<code>PropertySources</code>）中存在<code>dubbo.application.*</code> 时，<code>ApplicationConfig</code>  Bean 将被注册到在 Spring 上下文。否则，不会被注册。如果出现<code>dubbo.registry.*</code>的配置，那么，<code>RegistryConfig</code> Bean 将会创建，以此类推。即按需装配 Dubbo 配置 Bean。</p>
<p>如果需要指定配置 Bean的 id，可通过<code>**.id</code> 属性设置，以<code>dubbo.application</code> 为例：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## application</span></span><br><span class="line"><span class="meta">dubbo.application.id</span> = <span class="string">applicationBean</span></span><br><span class="line"><span class="meta">dubbo.application.name</span> = <span class="string">dubbo-demo-application</span></span><br></pre></td></tr></table></figure>



<p>以上配置等同于以下 Java Config Bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;applicationBean&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ApplicationConfig <span class="title">applicationBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationConfig applicationConfig = <span class="keyword">new</span> ApplicationConfig();</span><br><span class="line">    applicationConfig.setName(<span class="string">&quot;dubbo-demo-application&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> applicationConfig;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>大致上配置属性与配置类绑定模式 - <code>dubbo.application.* </code> 映射到 <code>ApplicationConfig</code> 中的字段。</p>
<blockquote>
<p>注：当配置属性名称无法在配置类中找到字段时，将会忽略绑定</p>
</blockquote>
<h5 id="多-Dubbo-配置-Bean-绑定"><a href="#多-Dubbo-配置-Bean-绑定" class="headerlink" title="多 Dubbo 配置 Bean 绑定"></a>多 Dubbo 配置 Bean 绑定</h5><p>Dubbo <code>@Service</code> 和 <code>@Reference</code> 允许 Dubbo 应用关联<code>ApplicationConfig</code> Bean 或者指定多个<code>RegistryConfig</code> Bean 等能力。换句话说，Dubbo 应用上下文中可能存在多个<code>ApplicationConfig</code> 等 Bean定义。</p>
<p>为了适应以上需要，因此从Dubbo <code>2.5.9</code> 开始，<code>@EnableDubboConfig</code> 支持多 Dubbo 配置 Bean 绑定，同时按照业界规约标准，与单 Dubbo 配置 Bean 绑定约定不同，配置属性前缀均为英文复数形式：</p>
<blockquote>
<p>详情请参考 ：<a target="_blank" rel="noopener" href="https://github.com/alibaba/dubbo/issues/1141">https://github.com/alibaba/dubbo/issues/1141</a></p>
</blockquote>
<ul>
<li><code>dubbo.applications</code></li>
<li><code>dubbo.modules</code></li>
<li><code>dubbo.registries</code></li>
<li><code>dubbo.protocols</code></li>
<li><code>dubbo.monitors</code></li>
<li><code>dubbo.providers</code></li>
<li><code>dubbo.consumers</code></li>
</ul>
<p>以<code>dubbo.applications</code> 为例，基本的模式如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">dubbo.applications.$&#123;bean-name&#125;.property-name</span> = <span class="string">$&#123;property-value&#125;</span></span><br></pre></td></tr></table></figure>



<p>请读者注意，在单 Dubbo 配置 Bean 绑定时，可以通过指定<code>id</code> 属性的方式，定义<code>ApplicationConfig</code> Bean 的ID，即<code>dubbo.application.id</code>。</p>
<p>而在多 Dubbo 配置 Bean 绑定时，Bean ID 则由<code>dubbo.applications.</code>与属性字段名称（<code>.property-name</code>)之间的字符来表达。</p>
<p>如下配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># multiple Bean definition</span></span><br><span class="line"><span class="meta">dubbo.applications.applicationBean.name</span> = <span class="string">dubbo-demo-application</span></span><br><span class="line"><span class="meta">dubbo.applications.applicationBean2.name</span> = <span class="string">dubbo-demo-application2</span></span><br><span class="line"><span class="meta">dubbo.applications.applicationBean3.name</span> = <span class="string">dubbo-demo-application3</span></span><br></pre></td></tr></table></figure>



<p>该配置内容中，绑定了三个<code>ApplicationConfig</code> Bean，分别是<code>applicationBean</code>、<code>applicationBean2</code>以及<code>applicationBean3</code></p>
<h4 id="示例说明"><a href="#示例说明" class="headerlink" title="示例说明"></a>示例说明</h4><p><code>@EnableDubboConfig</code> 的使用方法很简答， 再次强调一点，当规约的外部配置存在时，相应的 Dubbo 配置类 才会提升为 Spring Bean。简言之，按需装配。</p>
<h5 id="单-Dubbo-配置-Bean-绑定-1"><a href="#单-Dubbo-配置-Bean-绑定-1" class="headerlink" title="单 Dubbo 配置 Bean 绑定"></a>单 Dubbo 配置 Bean 绑定</h5><h6 id="外部化配置文件"><a href="#外部化配置文件" class="headerlink" title="外部化配置文件"></a>外部化配置文件</h6><p>将以下内容的外部化配置文件物理路径为：<code>classpath:/META-INF/config.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单 Dubbo 配置 Bean 绑定</span></span><br><span class="line"><span class="comment">## application</span></span><br><span class="line"><span class="meta">dubbo.application.id</span> = <span class="string">applicationBean</span></span><br><span class="line"><span class="meta">dubbo.application.name</span> = <span class="string">dubbo-demo-application</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## module</span></span><br><span class="line"><span class="meta">dubbo.module.id</span> = <span class="string">moduleBean</span></span><br><span class="line"><span class="meta">dubbo.module.name</span> = <span class="string">dubbo-demo-module</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## registry</span></span><br><span class="line"><span class="meta">dubbo.registry.address</span> = <span class="string">zookeeper://192.168.99.100:32770</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## protocol</span></span><br><span class="line"><span class="meta">dubbo.protocol.name</span> = <span class="string">dubbo</span></span><br><span class="line"><span class="meta">dubbo.protocol.port</span> = <span class="string">20880</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## monitor</span></span><br><span class="line"><span class="meta">dubbo.monitor.address</span> = <span class="string">zookeeper://127.0.0.1:32770</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## provider</span></span><br><span class="line"><span class="meta">dubbo.provider.host</span> = <span class="string">127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## consumer</span></span><br><span class="line"><span class="meta">dubbo.consumer.client</span> = <span class="string">netty</span></span><br></pre></td></tr></table></figure>



<h6 id="EnableDubboConfig-配置-Bean"><a href="#EnableDubboConfig-配置-Bean" class="headerlink" title="@EnableDubboConfig 配置 Bean"></a><code>@EnableDubboConfig</code> 配置 Bean</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dubbo 配置 Bean</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableDubboConfig</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;META-INF/config.properties&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="实现引导类"><a href="#实现引导类" class="headerlink" title="实现引导类"></a>实现引导类</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dubbo 配置引导类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboConfigurationBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建配置上下文</span></span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">        <span class="comment">// 注册当前配置 Bean</span></span><br><span class="line">        context.register(DubboConfiguration.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"> 	    <span class="comment">// application</span></span><br><span class="line">        ApplicationConfig applicationConfig = context.getBean(<span class="string">&quot;applicationBean&quot;</span>, ApplicationConfig.class);</span><br><span class="line">        System.out.printf(<span class="string">&quot;applicationBean.name = %s \n&quot;</span>, applicationConfig.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// module</span></span><br><span class="line">        ModuleConfig moduleConfig = context.getBean(<span class="string">&quot;moduleBean&quot;</span>, ModuleConfig.class);</span><br><span class="line">        System.out.printf(<span class="string">&quot;moduleBean.name = %s \n&quot;</span>, moduleConfig.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// registry</span></span><br><span class="line">        RegistryConfig registryConfig = context.getBean(RegistryConfig.class);</span><br><span class="line">        System.out.printf(<span class="string">&quot;registryConfig.name = %s \n&quot;</span>, registryConfig.getAddress());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// protocol</span></span><br><span class="line">        ProtocolConfig protocolConfig = context.getBean(ProtocolConfig.class);</span><br><span class="line">        System.out.printf(<span class="string">&quot;protocolConfig.name = %s \n&quot;</span>, protocolConfig.getName());</span><br><span class="line">        System.out.printf(<span class="string">&quot;protocolConfig.port = %s \n&quot;</span>, protocolConfig.getPort());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// monitor</span></span><br><span class="line">        MonitorConfig monitorConfig = context.getBean(MonitorConfig.class);</span><br><span class="line">        System.out.printf(<span class="string">&quot;monitorConfig.name = %s \n&quot;</span>, monitorConfig.getAddress());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// provider</span></span><br><span class="line">        ProviderConfig providerConfig = context.getBean(ProviderConfig.class);</span><br><span class="line">        System.out.printf(<span class="string">&quot;providerConfig.name = %s \n&quot;</span>, providerConfig.getHost());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// consumer</span></span><br><span class="line">        ConsumerConfig consumerConfig = context.getBean(ConsumerConfig.class);</span><br><span class="line">        System.out.printf(<span class="string">&quot;consumerConfig.name = %s \n&quot;</span>, consumerConfig.getClient());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">applicationBean.name &#x3D; dubbo-demo-application </span><br><span class="line">moduleBean.name &#x3D; dubbo-demo-module </span><br><span class="line">registryConfig.name &#x3D; zookeeper:&#x2F;&#x2F;192.168.99.100:32770 </span><br><span class="line">protocolConfig.name &#x3D; dubbo </span><br><span class="line">protocolConfig.port &#x3D; 20880 </span><br><span class="line">monitorConfig.name &#x3D; zookeeper:&#x2F;&#x2F;127.0.0.1:32770 </span><br><span class="line">providerConfig.name &#x3D; 127.0.0.1 </span><br><span class="line">consumerConfig.name &#x3D; netty </span><br></pre></td></tr></table></figure>



<p>不难发现，<code>@EnableDubboConfig</code> 配置 Bean 配合外部化文件 <code>classpath:/META-INF/config.properties</code>，与执行输出内容相同。</p>
<h5 id="多-Dubbo-配置-Bean-绑定-1"><a href="#多-Dubbo-配置-Bean-绑定-1" class="headerlink" title="多 Dubbo 配置 Bean 绑定"></a>多 Dubbo 配置 Bean 绑定</h5><h6 id="外部化配置文件-1"><a href="#外部化配置文件-1" class="headerlink" title="外部化配置文件"></a>外部化配置文件</h6><p>将以下内容的外部化配置文件物理路径为：<code>classpath:/META-INF/multiple-config.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多 Dubbo 配置 Bean 绑定</span></span><br><span class="line"><span class="comment">## dubbo.applications</span></span><br><span class="line"><span class="meta">dubbo.applications.applicationBean.name</span> = <span class="string">dubbo-demo-application</span></span><br><span class="line"><span class="meta">dubbo.applications.applicationBean2.name</span> = <span class="string">dubbo-demo-application2</span></span><br><span class="line"><span class="meta">dubbo.applications.applicationBean3.name</span> = <span class="string">dubbo-demo-application3</span></span><br></pre></td></tr></table></figure>



<h6 id="EnableDubboConfig-配置-Bean（多）"><a href="#EnableDubboConfig-配置-Bean（多）" class="headerlink" title="@EnableDubboConfig  配置 Bean（多）"></a><code>@EnableDubboConfig</code>  配置 Bean（多）</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDubboConfig(multiple = true)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;META-INF/multiple-config.properties&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboMultipleConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>



<h6 id="实现引导类-1"><a href="#实现引导类-1" class="headerlink" title="实现引导类"></a>实现引导类</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dubbo 配置引导类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboConfigurationBootstrap</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建配置上下文</span></span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">        <span class="comment">// 注册当前配置 Bean</span></span><br><span class="line">        context.register(DubboMultipleConfiguration.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 ApplicationConfig Bean：&quot;applicationBean&quot;、&quot;applicationBean2&quot; 和 &quot;applicationBean3&quot;</span></span><br><span class="line">        ApplicationConfig applicationBean = context.getBean(<span class="string">&quot;applicationBean&quot;</span>, ApplicationConfig.class);</span><br><span class="line">        ApplicationConfig applicationBean2 = context.getBean(<span class="string">&quot;applicationBean2&quot;</span>, ApplicationConfig.class);</span><br><span class="line">        ApplicationConfig applicationBean3 = context.getBean(<span class="string">&quot;applicationBean3&quot;</span>, ApplicationConfig.class);</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;applicationBean.name = %s \n&quot;</span>, applicationBean.getName());</span><br><span class="line">        System.out.printf(<span class="string">&quot;applicationBean2.name = %s \n&quot;</span>, applicationBean2.getName());</span><br><span class="line">        System.out.printf(<span class="string">&quot;applicationBean3.name = %s \n&quot;</span>, applicationBean3.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="执行结果-1"><a href="#执行结果-1" class="headerlink" title="执行结果"></a>执行结果</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">applicationBean.name &#x3D; dubbo-demo-application </span><br><span class="line">applicationBean2.name &#x3D; dubbo-demo-application2 </span><br><span class="line">applicationBean3.name &#x3D; dubbo-demo-application3 </span><br></pre></td></tr></table></figure>



<p><code>@EnableDubboConfig(multiple = true)</code> 执行后，运行结果说明<code>ApplicationConfig</code> Bean 以及 ID 的定义方式。 </p>
<h3 id="EnableDubboConfigBinding-amp-EnableDubboConfigBindings"><a href="#EnableDubboConfigBinding-amp-EnableDubboConfigBindings" class="headerlink" title="@EnableDubboConfigBinding &amp; @EnableDubboConfigBindings"></a><code>@EnableDubboConfigBinding</code> &amp; <code>@EnableDubboConfigBindings</code></h3><p><code>@EnableDubboConfig</code>适合绝大多数外部化配置场景，然而无论是单 Bean 绑定，还是多 Bean 绑定，其<strong>外部化配置属性前缀</strong>是固化的，如<code>dubbo.application</code> 以及 <code>dubbo.applications</code> 。</p>
<p>当应用需要自定义<strong>外部化配置属性前缀</strong>，<code>@EnableDubboConfigBinding</code>能提供更大的弹性，支持单个外部化配置属性前缀（<code>prefix</code>) 与 Dubbo 配置 Bean 类型（<code>AbstractConfig</code> 子类）绑定，如果需要多次绑定时，可使用<code>@EnableDubboConfigBindings</code>。</p>
<blockquote>
<p>尽管 Dubbo 推荐使用 Java 8 ，然而实际的情况，运行时的 JDK 的版本可能从 6到8 均有。因此，<code>@EnableDubboConfigBinding</code> 没有实现<code>java.lang.annotation.Repeatable</code>，即允许实现类不支持重复标注<code>@EnableDubboConfigBinding</code>。</p>
</blockquote>
<p><code>@EnableDubboConfigBinding</code>  在支持外部化配置属性与 Dubbo 配置类绑定时，与 Dubbo 过去的映射行为不同，被绑定的 Dubbo 配置类将会提升为 Spring Bean，无需提前装配 Dubbo 配置类。同时，支持多 Dubbo 配置Bean 装配。其 Bean 的绑定规则与<code>@EnableDubboConfig</code>一致。</p>
<h4 id="起始版本：-2-5-8"><a href="#起始版本：-2-5-8" class="headerlink" title="起始版本： 2.5.8"></a>起始版本： <code>2.5.8</code></h4><h4 id="使用说明-1"><a href="#使用说明-1" class="headerlink" title="使用说明"></a>使用说明</h4><h5 id="EnableDubboConfigBinding-定义"><a href="#EnableDubboConfigBinding-定义" class="headerlink" title="@EnableDubboConfigBinding 定义"></a><code>@EnableDubboConfigBinding</code> 定义</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableDubboConfigBinding &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The name prefix of the properties that are valid to bind to &#123;<span class="doctag">@link</span> AbstractConfig Dubbo Config&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the name prefix of the properties to bind</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">prefix</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The binding type of &#123;<span class="doctag">@link</span> AbstractConfig Dubbo Config&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> AbstractConfig</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> ApplicationConfig</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> ModuleConfig</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> RegistryConfig</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Class&lt;? extends AbstractConfig&gt; type();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * It indicates whether &#123;<span class="doctag">@link</span> #prefix()&#125; binding to multiple Spring Beans.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the default value is &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">multiple</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>prefix()</code> : 指定待绑定 Dubbo 配置类的外部化配置属性的前缀，比如<code>dubbo.application</code>  为 <code>ApplicationConfig</code> 的外部化配置属性的前缀。<code>prefix()</code> 支持占位符（Placeholder）, 并且其关联前缀值是否以”.” 作为结尾字符是可选的，即<code>prefix() = &quot;dubbo.application&quot;</code> 与 <code>prefix() = &quot;dubbo.application.&quot;</code> 效果相同 </li>
<li><code>type()</code> : 指定 Dubbo 配置类，所有 <code>AbstractConfig</code> 的实现子类即可，如<code>ApplicationConfig</code> 、<code>RegistryConfig</code> 以及 <code>ProtocolConfig</code> 等</li>
<li><code>multiple()</code> : 表明是否需要将<code>prefix()</code>   作为多个 <code>type()</code>   类型的 Spring Bean 外部化配置属性。默认值为<code>false</code>，即默认支持单个类型的 Spring 配置 Bean</li>
</ul>
<p>假设标注 <code>@EnableDubboConfigBinding</code> 的实现类被 Spring 应用上下文扫描并且注册后，其中<code>prefix()</code> =  <code>dubbo.app</code> 、 <code>type()</code> = <code>ApplicationConfig.class</code> ，且外部配置内容为：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">dubbo.app.id</span> = <span class="string">applicationBean</span></span><br><span class="line"><span class="meta">dubbo.app.name</span> = <span class="string">dubbo-demo-application</span></span><br></pre></td></tr></table></figure>



<p>Spring 应用上下文启动后，一个 ID 为 “applicationBean”   的 <code>ApplicationConfig</code>  Bean 被初始化，其 <code>name</code> 字段被设置为 “dubbo-demo-application”。</p>
<h5 id="EnableDubboConfigBindings-定义"><a href="#EnableDubboConfigBindings-定义" class="headerlink" title="EnableDubboConfigBindings 定义"></a><code>EnableDubboConfigBindings</code> 定义</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableDubboConfigBindings &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of &#123;<span class="doctag">@link</span> EnableDubboConfigBindings&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> non-null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EnableDubboConfigBinding[] value();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>value</code> : 指定多个<code>EnableDubboConfigBinding</code>，用于实现外部化配置属性前缀（<code>prefix</code>) 与 Dubbo 配置 Bean 类型（<code>AbstractConfig</code> 子类）绑定。</li>
</ul>
<h4 id="示例说明-1"><a href="#示例说明-1" class="headerlink" title="示例说明"></a>示例说明</h4><h5 id="外部化配置文件-2"><a href="#外部化配置文件-2" class="headerlink" title="外部化配置文件"></a>外部化配置文件</h5><p>将以下内容的外部化配置文件物理路径为：<code>classpath:/META-INF/bindings.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># classpath:/META-INF/bindings.properties</span></span><br><span class="line"><span class="comment">## 占位符值 : ApplicationConfig 外部配置属性前缀</span></span><br><span class="line"><span class="meta">applications.prefix</span> = <span class="string">dubbo.apps.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 多 ApplicationConfig Bean 绑定</span></span><br><span class="line"><span class="meta">dubbo.apps.applicationBean.name</span> = <span class="string">dubbo-demo-application</span></span><br><span class="line"><span class="meta">dubbo.apps.applicationBean2.name</span> = <span class="string">dubbo-demo-application2</span></span><br><span class="line"><span class="meta">dubbo.apps.applicationBean3.name</span> = <span class="string">dubbo-demo-application3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 单 ModuleConfig Bean 绑定</span></span><br><span class="line"><span class="meta">dubbo.module.id</span> = <span class="string">moduleBean</span></span><br><span class="line"><span class="meta">dubbo.module.name</span> = <span class="string">dubbo-demo-module</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 单 RegistryConfig Bean 绑定</span></span><br><span class="line"><span class="meta">dubbo.registry.address</span> = <span class="string">zookeeper://192.168.99.100:32770</span></span><br></pre></td></tr></table></figure>





<h5 id="EnableDubboConfigBindings-配置-Bean"><a href="#EnableDubboConfigBindings-配置-Bean" class="headerlink" title="EnableDubboConfigBindings 配置 Bean"></a><code>EnableDubboConfigBindings</code> 配置 Bean</h5><p><code>DubboConfiguration</code> 作为 Dubbo 配置 Bean，除通过 <code>@EnableDubboConfigBinding</code> 绑定之外，还需要 <code>@PropertySource</code> 指定外部化配置文件（<code>classpath:/META-INF/bindings.properties</code>）:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dubbo 配置 Bean</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableDubboConfigBindings(&#123;</span></span><br><span class="line"><span class="meta">        @EnableDubboConfigBinding(prefix = &quot;$&#123;applications.prefix&#125;&quot;,</span></span><br><span class="line"><span class="meta">                type = ApplicationConfig.class, multiple = true), // 多 ApplicationConfig Bean 绑定</span></span><br><span class="line"><span class="meta">        @EnableDubboConfigBinding(prefix = &quot;dubbo.module&quot;, // 不带 &quot;.&quot; 后缀</span></span><br><span class="line"><span class="meta">                type = ModuleConfig.class), // 单 ModuleConfig Bean 绑定</span></span><br><span class="line"><span class="meta">        @EnableDubboConfigBinding(prefix = &quot;dubbo.registry.&quot;, // 带 &quot;.&quot; 后缀</span></span><br><span class="line"><span class="meta">                type = RegistryConfig.class) // 单 RegistryConfig Bean 绑定</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;META-INF/bindings.properties&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboConfiguration</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="实现引导类-2"><a href="#实现引导类-2" class="headerlink" title="实现引导类"></a>实现引导类</h5><p>通过之前的使用说明，当 <code>EnableDubboConfigBinding</code> 将外部配置化文件<code>classpath:/META-INF/dubbo.properties</code> 绑定到 <code>ApplicationConfig</code>后，其中 Spring Bean “applicationBean” 的 name 字段被设置成 “dubbo-demo-application”。同时， <code>EnableDubboConfigBinding</code>  所标注的 <code>DubboConfiguration</code> 需要被 Sring 应用上下文注册：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dubbo 配置引导类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;mailto:mercyblitz@gmail.com&quot;&gt;Mercy&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboConfigurationBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建配置上下文</span></span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">        <span class="comment">// 注册当前配置 Bean</span></span><br><span class="line">        context.register(DubboConfiguration.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"> 		<span class="comment">// 获取 ApplicationConfig Bean：&quot;applicationBean&quot;、&quot;applicationBean2&quot; 和 &quot;applicationBean3&quot;</span></span><br><span class="line">        ApplicationConfig applicationBean = context.getBean(<span class="string">&quot;applicationBean&quot;</span>, ApplicationConfig.class);</span><br><span class="line">        ApplicationConfig applicationBean2 = context.getBean(<span class="string">&quot;applicationBean2&quot;</span>, ApplicationConfig.class);</span><br><span class="line">        ApplicationConfig applicationBean3 = context.getBean(<span class="string">&quot;applicationBean3&quot;</span>, ApplicationConfig.class);</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;applicationBean.name = %s \n&quot;</span>, applicationBean.getName());</span><br><span class="line">        System.out.printf(<span class="string">&quot;applicationBean2.name = %s \n&quot;</span>, applicationBean2.getName());</span><br><span class="line">        System.out.printf(<span class="string">&quot;applicationBean3.name = %s \n&quot;</span>, applicationBean3.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 ModuleConfig Bean：&quot;moduleBean&quot;</span></span><br><span class="line">        ModuleConfig moduleBean = context.getBean(<span class="string">&quot;moduleBean&quot;</span>, ModuleConfig.class);</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;moduleBean.name = %s \n&quot;</span>, moduleBean.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 RegistryConfig Bean</span></span><br><span class="line">        RegistryConfig registry = context.getBean(RegistryConfig.class);</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;registry.address = %s \n&quot;</span>, registry.getAddress());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h5><p><code>DubboConfigurationBootstrap</code> 运行后控制台输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">applicationBean.name &#x3D; dubbo-demo-application </span><br><span class="line">applicationBean2.name &#x3D; dubbo-demo-application2 </span><br><span class="line">applicationBean3.name &#x3D; dubbo-demo-application3 </span><br><span class="line">moduleBean.name &#x3D; dubbo-demo-module </span><br><span class="line">registry.address &#x3D; zookeeper:&#x2F;&#x2F;192.168.99.100:32770 </span><br></pre></td></tr></table></figure>



<p>输出的内容与<code>classpath:/META-INF/bindings.properties</code> 绑定的内容一致，符合期望。</p>

      
    </div>
      
        
        
      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>






<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">Prev</a>
  
  
    <a href="/page/4/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:jony.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2018/07/19/JVM/2018-09-10-JVM调优/">JVM调优</a>
      </li>
    
      <li>
        <a href="/2018/07/02/JVM/2018-07-02-项目中遇到的java堆溢出解决/">项目中遇到的java堆溢出解决</a>
      </li>
    
      <li>
        <a href="/2018/04/11/JVM/2018-04-11-8_虚拟机类加载机制/">虚拟机类加载机制</a>
      </li>
    
      <li>
        <a href="/2018/04/11/JVM/2018-04-11-7_Class文件结构/">Class文件结构</a>
      </li>
    
      <li>
        <a href="/2018/04/11/JVM/2018-04-11-6_JVM参数/">JVM参数</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/AngularJS/">AngularJS</a><small>1</small></li>
  
    <li><a href="/categories/JVM/">JVM</a><small>12</small></li>
  
    <li><a href="/categories/Java/">Java</a><small>12</small></li>
  
    <li><a href="/categories/Java并发/">Java并发</a><small>5</small></li>
  
    <li><a href="/categories/Linux/">Linux</a><small>3</small></li>
  
    <li><a href="/categories/Maven/">Maven</a><small>1</small></li>
  
    <li><a href="/categories/算法/">算法</a><small>3</small></li>
  
    <li><a href="/categories/网络编程/">网络编程</a><small>3</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/AngularJS/" style="font-size: 10px;">AngularJS</a> <a href="/tags/JVM/" style="font-size: 20px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Java%E5%B9%B6%E5%8F%91/" style="font-size: 16.67px;">Java并发</a> <a href="/tags/Linux/" style="font-size: 13.33px;">Linux</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.33px;">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" style="font-size: 13.33px;">网络编程</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2020 jony
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



</body>
</html>

